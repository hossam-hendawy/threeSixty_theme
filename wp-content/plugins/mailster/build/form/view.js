(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var s in r)e.o(r,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:r[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.apiFetch;var r=e.n(t);const s=window.wp.domReady;var o=e.n(s);!function(){const e=(e,t,r)=>{e.addEventListener(t,r)},t=(e,t,r)=>{e.removeEventListener(t,r)},s=(e,t)=>Array.prototype.slice.call(e.querySelectorAll(t)),a=(e,t)=>e.querySelector(t),i=window,l=i.document,n=i.setTimeout,c=i.clearTimeout,d=l.documentElement;let f=null;const u="click",m="mouseout",p="scroll",h="touchstart",v="mousedown",b="mousemove",g="keydown",y="keyup",k="keypress";function L(e){e.stopPropagation()}function w(e,t,r){let s;return()=>{let o=this,a=arguments,i=r&&!s;c(s),s=n((()=>{s=null,r||e.apply(o,a)}),t),i&&e.apply(o,a)}}function E(e,t,r){const s="mailster-form-"+e;if(void 0===r){const e=JSON.parse(i.localStorage.getItem(s));return t?e&&e[t]?e[t]:null:e}{const o=E(e)||{};o[t]=r,i.localStorage.setItem(s,JSON.stringify(o))}}function A(e,t,r){const s="mailster_form_"+e,o=i[s]||{};if(void 0===r)return t?o[t]:o;o[t]=r,i[s]=o}function _(e,t,r){try{const e="__test__";i.localStorage.setItem(e,e),i.localStorage.removeItem(e),_=E}catch(e){_=A}return _(e,t,r)}o()((()=>{const o=s(l,".mailster-block-form"),E=i.mailsterBlockEvents||{},A=function(){let e={};const t=i.location.search.replace("?","").split("&");for(var r=t.length,s=0;s<r;s++){var o=t[s].slice(0,t[s].search("=")),a=t[s].slice(t[s].search("=")).replace("=","");e[o]=a}return e}();Array.prototype.forEach.call(o,((o,T)=>{const S=a(o,".mailster-block-form-data"),O=JSON.parse(S.textContent),C=o.closest(".wp-block-mailster-form-outside-wrapper"),D=s(C,".mailster-block-form-close, .mailster-block-form-inner-close"),P=D[D.length-1],x=a(C,'button,[href],input,select,textarea,[tabindex]:not([tabindex="-1"])'),I=a(o,".mailster-block-form-info"),H=3600*(O.cooldown||0),j="submission"==O.type;let M=null,R=null,J=!1;const N={delay:()=>{M=n((()=>{B()&&V()}),1e3*O.trigger_delay)},inactive:()=>{e(i,v,U),e(i,b,U),e(i,k,U),e(i,p,U),e(i,h,U)},scroll:function(){e(i,p,q),e(i,h,q)},click:()=>{const t=s(l,O.trigger_click);Array.prototype.forEach.call(t,((t,r)=>{e(t,u,V)}))},exit:()=>{e(l,m,F)}};Array.prototype.forEach.call(s(l,".has-mailster-form-"+O.identifier),((t,r)=>{e(t,u,V)}));const U=w((function(e){c(R),R=n((()=>{B()&&V()}),1e3*O.trigger_inactive)}),100),q=w((function(e){if(scroll.el=scroll.el||d,scroll.body=scroll.body||l.body,(scroll.el.scrollTop||scroll.body.scrollTop)/((scroll.el.scrollHeight||scroll.body.scrollHeight)-scroll.el.clientHeight)>=O.trigger_scroll/100){if(!B())return;V()}}),50);function F(e){if(!e.toElement&&!e.relatedTarget){if(!B())return;V()}}function K(e){if(e.preventDefault(),J)return;J=!0;let t=new FormData(o),i={},c=[],d=a(I,".mailster-block-form-info-success"),f=a(I,".mailster-block-form-info-error");o.classList.remove("completed"),s(o,".is-error").forEach((e=>{e.classList.remove("is-error")})),s(o,"[aria-invalid]").forEach((e=>{e.removeAttribute("aria-invalid")})),o.classList.add("loading"),o.setAttribute("aria-disabled",!0),l.referrer&&new URL(l.referrer).origin!==l.location.origin?t.append("_referer",l.referrer):t.append("_referer",l.location.href);let u,m=t.getAll("_lists[]");m.length||t.append("_lists[]",[]);for(let e of t.keys())"_lists[]"==e?(u=m,e=e.replace("[]","")):u=t.get(e),i[e]=u;r()({path:"mailster/v1/forms/"+O.id+"/"+O.type,method:j?"POST":"PATCH",data:i}).then((e=>{X("conversion"),ee("submit",{...e.data,formdata:i}),I.classList.remove("is-error"),o.classList.remove("has-errors"),j&&e.data.redirect?n((()=>location.href=e.data.redirect),150):(e.message&&c.push(e.message),c.length&&(d.innerHTML=c.join("<br>")),I.setAttribute("role","alert"),I.classList.add("is-success"),j&&(o.classList.add("completed"),l.activeElement.blur(),ee("complete",{...e.data,formdata:i}),O.triggers&&n((()=>{$(),o.reset()}),3e3)))})).catch((e=>{e.data.fields?(o.classList.add("has-errors"),Object.keys(e.data.fields).map((t=>{const r=a(o,".wp-block-mailster-"+t+", .wp-block-mailster-field-"+t),s="hint-"+O.identifier+"-"+t;if(r){const e=a(r,"input, select, textarea");e.setAttribute("aria-invalid","true"),e.setAttribute("aria-describedby",s),r.classList.add("is-error")}let i=r?.dataset?.errorMessage||e.data.fields[t];console.error("["+t+"]",i),c.push('<div id="'+s+'" role="alert">'+i+"</div>")}))):e.message&&(console.error(e.message),c.push(e.message)),I.classList.remove("is-success"),I.classList.add("is-error"),f.innerHTML=c.join(""),ee("error",{...e.data,formdata:i})})).finally((()=>{X("show"),o.classList.remove("loading"),o.removeAttribute("aria-disabled"),I.setAttribute("aria-hidden","false"),J=!1}))}function B(){return!!O.isPreview||!Y("conversion")&&!G("closed",H)}function G(e,t){return!(Y(e,0)<+new Date-1e3*t)}function V(r){if(C&&!C.classList.contains("active")){if(f)return;f=O,c(M),c(R),t(l,m,F),t(i,p,q),t(i,h,q),t(i,v,U),t(i,b,U),t(i,k,U),t(i,b,U),t(i,p,U),t(i,h,U),e(l,y,Q),e(l,g,W),n((()=>e(C,u,z)),1500),D.forEach((t=>e(t,u,z))),e(o,u,L),C.classList.add("active"),I.classList.remove("is-success"),o.classList.remove("completed"),C.setAttribute("aria-hidden","false"),C.focus(),d.classList.add("mailster-form-active"),r&&r.type===u&&(r.preventDefault(),n((()=>x.focus()),500)),ee("open"),Z()}}function $(){t(l,y,Q),t(l,g,W),t(C,u,$),t(C,u,z),D.forEach((e=>t(e,u,z))),t(o,u,L),C.classList.add("closing"),d.classList.remove("mailster-form-active"),ee("close"),n((()=>{C.classList.remove("closing"),C.classList.remove("active"),C.setAttribute("aria-hidden","true")}),500),f=null}function z(e){e&&e.preventDefault(),$(),X("closed")}function Q(e){"Escape"!==e.key&&27!=e.keyCode||z()}function W(e){"Tab"!==e.key&&9!==e.keyCode||(x===e.target&&e.shiftKey&&(P.focus(),e.preventDefault()),P!==e.target||e.shiftKey||(x.focus(),e.preventDefault())),"Enter"!==e.key&&13!=e.keyCode||(K(e),e.preventDefault())}function X(e,t){return j?_(O.identifier,e,t||+new Date):null}function Y(e,t=null){if(!j)return null;return _(O.identifier,e)||t}function Z(){if(O.isPreview||!j)return!1;G("impression",3600)||r()({path:"mailster/v1/forms/"+O.id+"/impression",method:"POST",data:O}).catch((e=>{e.message&&console.error(e.message)})).finally((()=>{ee("impression"),X("impression")}))}function ee(e,t){const r={type:e,el:o,form:O,data:t},s=new CustomEvent("mailster:"+e,{bubbles:!0,detail:r});return r.event=s,E[O.id]&&E[O.id][e]&&E[O.id][e].apply(r),o.dispatchEvent(s)}if(O.prefill&&A&&Object.entries(A).forEach((([e,t])=>{const r=a(o,'[name="'+e+'"]');if(r)switch(r.type){case"checkbox":r.checked=!!t&&"false"!==t;break;case"radio":const a=s(o,'[name="'+e+'"]');for(let e=0;e<a.length;e++)a[e].checked=a[e].value==decodeURIComponent(t);break;case"date":r.value=t;break;default:r.value=decodeURIComponent(t)}})),O){if(O.triggers)O.triggers.forEach((e=>{N[e]&&N[e].call(this)})),C.classList.add(function(e){let t=e.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+\.{0,1}\d*))?\)$/);return(299*t[1]+587*t[2]+114*t[3])/1e3>=128?"is-light-bg":"is-dark-bg"}(i.getComputedStyle(C,"").getPropertyValue("background-color")));else{const e=new IntersectionObserver((t=>{t[0].isIntersecting&&(Z(),e.unobserve(t[0].target))}),{threshold:1});e.observe(o),ee("load")}j||(o.classList.add("loading","silent"),o.setAttribute("aria-disabled",!0),J=!0,r()({path:"mailster/v1/forms/"+O.id+"/data",method:"GET"}).then((e=>{for(const t in e.data){const r=a(o,'[name="'+t+'"]'),i=e.data[t];if(r&&i)switch(r.type){case"checkbox":r.checked=!!i;break;case"radio":const e=s(o,'[name="'+t+'"]');for(let t=0;t<e.length;t++)e[t].checked=e[t].value==i;break;default:r.value=i}}if(e.lists){const t=s(o,'[name="_lists[]"]');for(let r=0;r<t.length;r++)t[r].checked=e.lists.includes(t[r].value)}})).catch((e=>{console.error(e),o.classList.add("has-errors"),a(I,".mailster-block-form-info-error").innerHTML=e?.message})).finally((()=>{o.classList.remove("loading","silent"),o.removeAttribute("aria-disabled"),I.setAttribute("aria-hidden","false"),J=!1})))}e(o,"submit",K)}))}))}()})();