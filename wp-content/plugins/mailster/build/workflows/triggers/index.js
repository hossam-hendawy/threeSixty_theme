(()=>{var e={6942:(e,t)=>{var s;!function(){"use strict";var r={}.hasOwnProperty;function n(){for(var e="",t=0;t<arguments.length;t++){var s=arguments[t];s&&(e=i(e,o(s)))}return e}function o(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return n.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var s in e)r.call(e,s)&&e[s]&&(t=i(t,s));return t}function i(e,t){return t?e?e+" "+t:e+t:e}e.exports?(n.default=n,e.exports=n):void 0===(s=function(){return n}.apply(t,[]))||(e.exports=s)}()}},t={};function s(r){var n=t[r];if(void 0!==n)return n.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,s),o.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e={};s.r(e),s.d(e,{getActions:()=>h,getCampaignStats:()=>y,getCampaigns:()=>S,getEmails:()=>v,getFields:()=>_,getForms:()=>x,getLists:()=>g,getNumbers:()=>f,getQueue:()=>p,getTags:()=>w,getTriggers:()=>d});var t={};s.r(t),s.d(t,{clearNumbers:()=>C,getActions:()=>L,getCampaignStats:()=>V,getCampaigns:()=>O,getEmails:()=>H,getFields:()=>R,getForms:()=>W,getLists:()=>A,getNumbers:()=>T,getQueue:()=>I,getTags:()=>G,getTriggers:()=>E,setActions:()=>N,setCampaignStats:()=>q,setCampaigns:()=>F,setEmails:()=>U,setFields:()=>M,setForms:()=>D,setLists:()=>P,setNumbers:()=>b,setQueue:()=>j,setTags:()=>B,setTriggers:()=>k});var r={};s.r(r),s.d(r,{getActions:()=>re,getCampaignStats:()=>le,getCampaigns:()=>ae,getEmails:()=>ue,getFields:()=>ie,getForms:()=>ce,getLists:()=>ne,getNumbers:()=>te,getQueue:()=>se,getTags:()=>oe,getTriggers:()=>ee});var n={};s.r(n),s.d(n,{GET_ACTIONS:()=>ge,GET_CAMPAIGNS:()=>ye,GET_CAMPAIGN_STATS:()=>xe,GET_EMAILS:()=>ke,GET_FIELDS:()=>Se,GET_FORMS:()=>ve,GET_LISTS:()=>we,GET_NUMBERS:()=>pe,GET_QUEUE:()=>he,GET_TAGS:()=>_e,GET_TRIGGERS:()=>fe});const o=window.wp.blocks,i=window.wp.i18n,a=window.wp.editor,l=window.wp.plugins,c=window.wp.element,u=window.wp.data,m=window.wp.components;function d(e){const{triggers:t}=e;return t}function f(e){const{numbers:t}=e;return t}function p(e){const{queue:t}=e;return t}function h(e){const{actions:t}=e;return t}function g(e){const{lists:t}=e;return t}function w(e){const{tags:t}=e;return t}function _(e){const{fields:t}=e;return t}function S(e){const{campaigns:t}=e;return t}function y(e,t){const{stats:s}=e;return s[t]||[]}function x(e){const{forms:t}=e;return t}function v(e){const{emails:t}=e;return t}function k(e){return{type:"SET_TRIGGERS",triggers:e}}function E(e){return{type:"GET_TRIGGERS",path:e}}function b(e){return{type:"SET_NUMBERS",numbers:e}}function T(e){return{type:"GET_NUMBERS",path:e}}function j(e){return{type:"SET_QUEUE",queue:e}}function I(e){return{type:"GET_QUEUE",path:e}}function C(){return{type:"CLEAR_NUMBERS"}}function N(e){return{type:"SET_ACTIONS",actions:e}}function L(e){return{type:"GET_ACTIONS",path:e}}function P(e){return{type:"SET_LISTS",lists:e}}function A(e){return{type:"GET_LISTS",path:e}}function B(e){return{type:"SET_TAGS",tags:e}}function G(e){return{type:"GET_TAGS",path:e}}function M(e){return{type:"SET_FIELDS",fields:e}}function R(e){return{type:"GET_FIELDS",path:e}}function F(e){return{type:"SET_CAMPAIGNS",campaigns:e}}function O(e){return{type:"GET_CAMPAIGNS",path:e}}function q(e,t){return{type:"SET_CAMPAIGN_STATS",campaign:t,stats:e}}function V(e,t){return{type:"GET_CAMPAIGN_STATS",campaign:t,path:e}}function D(e){return{type:"SET_FORMS",forms:e}}function W(e){return{type:"GET_FORMS",path:e}}function U(e){return{type:"SET_EMAILS",emails:e}}function H(e){return{type:"GET_EMAILS",path:e}}window.lodash,window.moment;const z=window.ReactJSXRuntime;function Q({id:e,align:t}){const s=new URL("https://kb.mailster.co/"+e);s.searchParams.set("utm_campaign","plugin"),s.searchParams.set("utm_medium","link"),s.searchParams.set("utm_source","Mailster Plugin"),s.searchParams.set("utm_term","workflow");var r={};return t&&(r.float=t),(0,z.jsx)("a",{className:"mailster-help",href:s.toString(),"data-article":e,style:r})}function Y(){return new Promise((e=>{const t=(0,u.subscribe)((()=>{if((0,u.select)("core/editor").isCleanNewPost()||(0,u.select)("core/block-editor").getBlockCount()>0){const s=document.querySelector('iframe[name="editor-canvas"]'),r=s?s.contentWindow:window,n=()=>{r.removeEventListener("load",n),t(),e(r)};r.document.querySelector(".is-root-container")?n():r.addEventListener("load",n)}}))}))}function $(e){let t=null;Y().then((s=>{(0,u.subscribe)((()=>{const r=s.document.querySelectorAll(".wp-block").length;r!==t&&(t=r,e(t))}))}))}function X(e,t,s=!0){const r=Z(e,t,s);return!!r.length&&r[0]}function Z(e,t=null,s=!0){const{getBlocks:r,getBlockRootClientId:n}=(0,u.select)("core/block-editor"),o=r(t);let i=[];return function t(r){r.forEach((r=>{r.name&&new RegExp(e,"g").test(r.name)&&(r.rootClientId=n(r.clientId),i.push(r)),s&&r.innerBlocks.length>0&&t(r.innerBlocks)}))}(o),i}function J(e,t){(0,u.dispatch)(t).invalidateResolutionForStoreSelector(e)}function K(e,t,s=!1){const r=(0,c.useRef)(null),n=(0,c.useRef)(e);return(0,c.useEffect)((()=>{n.current=e}),[e]),(0,c.useEffect)((()=>{const e=()=>n.current();if(s&&n.current&&e(),"number"==typeof t)return r.current=window.setInterval(e,t),()=>window.clearInterval(r.current)}),[t]),r}function*ee(){return k(yield E("/mailster/v1/automations/triggers"))}function*te(){const e=(0,u.select)("core/editor").getCurrentPostId();return b(yield T("/mailster/v1/automations/numbers/"+e))}function*se(){const e=(0,u.select)("core/editor").getCurrentPostId();return j(yield I("/mailster/v1/automations/queue/"+e))}function*re(){return N(yield L("/mailster/v1/automations/actions"))}function*ne(){return P(yield A("/mailster/v1/automations/lists"))}function*oe(){return B(yield G("/mailster/v1/automations/tags"))}function*ie(){return M(yield R("/mailster/v1/automations/fields"))}function*ae(){return F(yield O("/mailster/v1/automations/campaigns"))}function*le(e){return e?q(yield V("/mailster/v1/automations/stats/"+e,e),e):[]}function*ce(){return D(yield W("/mailster/v1/automations/forms"))}function*ue(){return U(yield H())}const me=window.wp.apiFetch;var de=s.n(me);function fe(e){return de()({path:e.path})}function pe(e){return de()({path:e.path})}function he(e){return de()({path:e.path})}function ge(e){return de()({path:e.path})}function we(e){return de()({path:e.path})}function _e(e){return de()({path:e.path})}function Se(e){return de()({path:e.path})}function ye(e){return de()({path:e.path})}function xe(e){return de()({path:e.path})}function ve(e){return de()({path:e.path})}function ke(e){return Z("mailster-workflow/email").map((e=>({name:e.attributes.name,campaign:e.attributes.campaign,id:e.attributes.id})))}const Ee={triggers:null,numbers:null,queue:null,actions:null,lists:[],tags:[],fields:[],campaigns:[],stats:[],emails:[]};(0,u.registerStore)("mailster/automation",{selectors:e,actions:t,resolvers:r,reducer:(e=Ee,t)=>{switch(t.type){case"SET_TRIGGERS":return{...e,triggers:t.triggers};case"SET_NUMBERS":return{...e,numbers:t.numbers};case"CLEAR_NUMBERS":return{...e,numbers:Ee.numbers};case"SET_QUEUE":return{...e,queue:t.queue};case"SET_ACTIONS":return{...e,actions:t.actions};case"SET_LISTS":return{...e,lists:t.lists};case"SET_TAGS":return{...e,tags:t.tags};case"SET_FIELDS":return{...e,fields:t.fields};case"SET_CAMPAIGNS":return{...e,campaigns:t.campaigns};case"SET_CAMPAIGN_STATS":let s={...e};return s.stats[t.campaign]=t.stats,s;case"SET_FORMS":return{...e,forms:t.forms};case"SET_EMAILS":return{...e,emails:t.emails};case"FAIL_RESOLUTION":return console.error(t),e;default:return e}},controls:n});const be=window.wp.coreData,Te=(0,window.wp.date.getSettings)();(0,i.__)("Minute","mailster"),(0,i.__)("Minutes","mailster"),(0,i.__)("Hour","mailster"),(0,i.__)("Hours","mailster"),(0,i.__)("Day","mailster"),(0,i.__)("Days","mailster"),(0,i.__)("Week","mailster"),(0,i.__)("Weeks","mailster"),(0,i.__)("Month","mailster"),(0,i.__)("Months","mailster"),(0,i.__)("Specific Time of the day","mailster"),(0,i.__)("Specific day of the week","mailster"),(0,i.__)("Specific day of the month","mailster"),(0,i.__)("Specific date","mailster"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"1st"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"2nd"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"3rd"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"4th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"5th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"6th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"7th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"8th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"9th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"10th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"11st"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"12nd"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"13rd"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"14th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"15th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"16th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"17th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"18th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"19th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"20th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"21st"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"22nd"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"23rd"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"24th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"25th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"26th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"27th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"28th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"29th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"30th"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"31st"),(0,i.sprintf)((0,i.__)("%s day of the month","mailster"),"Last"),Te.l10n.weekdays.slice(Te.l10n.startOfWeek),Te.l10n.weekdays.slice(0,Te.l10n.startOfWeek),Te.l10n.startOfWeek,Te.formats.date,Te.formats.time,Te.formats.datetime,Te.formats.time.match(/[a|A]/);const je=window.wp.blockEditor,Ie=window.wp.compose,{Fill:Ce,Slot:Ne}=(0,m.createSlotFill)("mailster/trigger/selector");function Le(e){const[t,s]=(0,be.useEntityProp)("postType","mailster-workflow","title");return(0,z.jsx)(a.PluginDocumentSettingPanel,{name:"options",title:(0,i.__)("Options","mailster"),children:(0,z.jsx)(m.TextControl,{__nextHasNoMarginBottom:!0,label:(0,i.__)("Workflow Name","mailster"),value:t,onChange:e=>s(e),help:(0,i.__)("Define a name for your workflow.","mailster"),placeholder:(0,i.__)("Add Workflow name","mailster")})})}function Pe(e){const{attributes:t,setAttributes:s,isSelected:r,clientId:n}=e,{resetBlocks:o}=(0,u.useDispatch)("core/block-editor"),{__experimentalGetAllowedPatterns:a}=(0,u.useSelect)("core/block-editor"),{isCleanNewPost:l}=(0,u.useSelect)("core/editor"),[d,f]=(0,be.useEntityProp)("postType","mailster-workflow","title"),[p,h]=(0,c.useState)([]),[g,w]=(0,c.useState)(!1);(0,c.useEffect)((()=>{l()&&(h(a()),w(!0))}),[]);const _=e=>{const t=wp.blocks.parse(e.content),s="mailster-workflow/scratch"==e.name;o(t),!d&&!s&&f(e.title||""),w(!1)};(0,c.useEffect)((()=>{if(!g)return;const e=setTimeout((()=>{0==p.length&&S()}),2e3);return()=>clearTimeout(e)}),[g]);const S=()=>{setTimeout((()=>{h(a())}),1),h([])};return g?(0,z.jsxs)(m.Modal,{title:(0,i.__)("Choose a Workflow","mailster"),onRequestClose:()=>{window.location=window.location.href.replace("post-new.php","edit.php")},isFullScreen:!0,isDismissible:!0,shouldCloseOnClickOutside:!1,shouldCloseOnEsc:!1,className:"mailster-patterns-modal",children:[(0,z.jsx)(Q,{id:"6460f6909a2fac195e609002",align:"right"}),(0,z.jsxs)("div",{className:"mailster-patterns-explorer",children:[0==p.length&&(0,z.jsx)(m.Flex,{className:"mailster-patterns-loader",justify:"center",children:(0,z.jsx)(m.FlexItem,{children:(0,z.jsxs)(m.BaseControl,{__nextHasNoMarginBottom:!0,children:[(0,z.jsx)(m.Spinner,{}),(0,z.jsx)(m.Button,{onClick:S,variant:"link",children:(0,i.__)("Loading Workflows","mailster")})]})})}),p&&p.map(((e,t)=>(0,z.jsx)(Ae,{pattern:e,onInsertPattern:_},t)))]})]}):(0,z.jsx)(z.Fragment,{})}function Ae({pattern:e,onInsertPattern:t}){const s="mailster-pattern",{title:r,categories:n=[],blocks:o,article:a}=e,l=(0,c.useRef)(null),u=o.filter((e=>"mailster-workflow/comment"!=e.name)).map((e=>(e.attributes.isExample=!0,e))),d=()=>{t(e)},[f,p]=(0,c.useState)(!1);(0,c.useEffect)((()=>{if(!l.current)return;const e=new IntersectionObserver((t=>{t[0].isIntersecting&&(p(!0),e.unobserve(l.current))}),{threshold:[0]});e.observe(l.current)}),[l.current]);const h=e.viewportWidth;return(0,z.jsx)(m.Card,{className:s,"aria-label":e.title,ref:l,children:(0,z.jsxs)(m.Flex,{align:"center",justify:"space-between",className:`${s}-inner`,children:[(0,z.jsx)(m.FlexItem,{className:`${s}-preview`,onClick:d,children:f&&(0,z.jsx)(je.BlockPreview,{blocks:u,viewportWidth:h,minHeight:344,additionalStyles:[{css:"body { padding: 16px }"}]})}),(0,z.jsxs)(m.FlexItem,{className:`${s}-actions`,children:[(0,z.jsx)("h5",{className:`${s}-category`}),(0,z.jsx)("h3",{className:`${s}-title`,children:r}),(0,z.jsx)("p",{children:e.description}),(0,z.jsx)(m.Button,{variant:"secondary",onClick:d,children:(0,i.__)("Start with this Workflow","mailster")}),a&&(0,z.jsx)("p",{children:(0,z.jsx)(m.ExternalLink,{href:a,target:"_blank",children:(0,i.__)("Learn how to use this Workflow","mailster")})})]})]})})}function Be(e){return(0,z.jsx)(a.PluginPostStatusInfo,{children:(0,z.jsx)(m.PanelRow,{})})}const Ge=window.wp.primitives,Me=(0,z.jsx)(Ge.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,z.jsx)(Ge.Path,{d:"M12 4L4 7.9V20h16V7.9L12 4zm6.5 14.5H14V13h-4v5.5H5.5V8.8L12 5.7l6.5 3.1v9.7z"})}),Re=(0,z.jsx)(Ge.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,z.jsx)(Ge.Path,{d:"M7 11.5h10V13H7z"})}),Fe=(0,z.jsx)(Ge.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,z.jsx)(Ge.Path,{d:"M11 12.5V17.5H12.5V12.5H17.5V11H12.5V6H11V11H6V12.5H11Z"})});function Oe(){const e=(0,u.select)("core/editor").getCurrentPostId(),[t,s]=function(e,t){e="mailster_"+e;const[s,r]=(0,c.useState)((()=>{if("undefined"==typeof window)return t;try{const s=window.sessionStorage.getItem(e);return s?JSON.parse(s):t}catch(e){return console.error(e),t}}));return[s,t=>{try{const n=t instanceof Function?t(s):t;r(n),"undefined"!=typeof window&&window.sessionStorage.setItem(e,JSON.stringify(n))}catch(e){console.error(e)}}]}("workflow-"+e),r=document.querySelector('iframe[name="editor-canvas"]'),[n,o]=(0,c.useState)(),[a,l]=(0,c.useState)(),[d,f]=(0,c.useState)(),p=(0,Ie.useDebounce)((()=>{let e=_();S(e.x,e.y),s(e)}),400);!function(e){const[t,s]=(0,c.useState)();(0,c.useEffect)((()=>{Y().then((t=>{s(t),e&&e(t)}))}),[])}((e=>{const t=e.document;l(t.querySelector(".interface-interface-skeleton__content")||e),f(t.querySelector(".editor-styles-wrapper")),o(!0)})),(0,c.useEffect)((()=>{if(!d)return;let e,s,r,n;function o(t){t.preventDefault();const o=_();e=t.clientX-r,s=t.clientY-n,r=t.clientX,n=t.clientY;let i=Math.max(0,o.x-e),a=Math.max(0,o.y-s);w(i,a)}function i(e){d.classList.remove("dragging"),d.removeEventListener("mouseup",i),d.removeEventListener("mouseleave",i),d.removeEventListener("mousemove",o),a.addEventListener("scroll",p),g(_())}d.addEventListener("mousedown",(function(e){(e.target.classList.contains("is-root-container")||e.target.classList.contains("editor-styles-wrapper")||e.target.classList.contains("canvas-handle"))&&(r=e.clientX||e.changedTouches[0].clientX,n=e.clientY||e.changedTouches[0].clientY,d.classList.add("dragging"),d.addEventListener("mouseup",i),d.addEventListener("mouseleave",i),d.addEventListener("mousemove",o),a.removeEventListener("scroll",p))})),a.addEventListener("scroll",p),t?w(t.x,t.y,t.z):y(!0),d.classList.add("loaded")}),[d]);const h=e=>{w(t?.x,t?.y,e),g({z:e})},g=e=>{s({...t,...e})},w=(e,t,s)=>{d&&(a.scrollTo(e,t),s&&(d.style.scale=`${s}%`),S(e,t))},_=()=>({x:r?a.scrollX:a.scrollLeft,y:r?a.scrollY:a.scrollTop,z:100*(d.style.scale||1)}),S=(e,t)=>{};(0,c.useEffect)((()=>{d&&t&&h(t.z)}),[d]);const y=()=>{const e=d.querySelector(".wp-block-mailster-workflow-triggers");e?(setTimeout((()=>{e.scrollIntoView({inline:"center",block:"center",behavior:"smooth"})}),100),h(100)):w(0,0,100)},x=t?t.z:100;return n?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(m.Button,{variant:"tertiary",icon:Me,onClick:y,label:(0,i.__)("Reset View","mailster")}),(0,z.jsx)(m.Button,{variant:"tertiary",icon:Re,disabled:40===x,onClick:()=>{h(Math.max(x-10,40))},label:(0,i.__)("Zoom Out","mailster")}),(0,z.jsx)(m.Button,{variant:"tertiary",icon:Fe,disabled:100===x,onClick:()=>{h(Math.min(x+10,100))},label:(0,i.__)("Zoom In","mailster")})]}):null}const qe=(0,z.jsx)(Ge.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,z.jsx)(Ge.Path,{d:"M16.7 7.1l-6.3 8.5-3.3-2.5-.9 1.2 4.5 3.4L17.9 8z"})}),Ve=(0,z.jsx)(Ge.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,z.jsx)(Ge.Path,{d:"M12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21ZM15.5303 8.46967C15.8232 8.76256 15.8232 9.23744 15.5303 9.53033L13.0607 12L15.5303 14.4697C15.8232 14.7626 15.8232 15.2374 15.5303 15.5303C15.2374 15.8232 14.7626 15.8232 14.4697 15.5303L12 13.0607L9.53033 15.5303C9.23744 15.8232 8.76256 15.8232 8.46967 15.5303C8.17678 15.2374 8.17678 14.7626 8.46967 14.4697L10.9393 12L8.46967 9.53033C8.17678 9.23744 8.17678 8.76256 8.46967 8.46967C8.76256 8.17678 9.23744 8.17678 9.53033 8.46967L12 10.9393L14.4697 8.46967C14.7626 8.17678 15.2374 8.17678 15.5303 8.46967Z"})}),De=(0,i.__)("You have reached the limit of %d workflows! Your workflow is saved but disabled. Please upgrade your plan to use more workflows.","mailster");function We(e){const{createNotice:t,removeNotice:s}=(0,u.useDispatch)("core/notices"),{editPost:r}=(0,u.useDispatch)("core/editor"),{isAutosavingPost:n,isSavingPost:o,isCleanNewPost:a}=(0,u.useSelect)("core/editor"),l=(0,u.useSelect)((e=>e("core/editor").getEditedPostAttribute("status")),[]),[d,f]=(0,c.useState)((0,u.select)("core/editor").getEditedPostAttribute("status")),[p,h]=(0,c.useState)(),g="publish"===l,w=(0,u.subscribe)((()=>{if(n())return;if(!o())return;const e=(0,u.select)("core/editor").getEditedPostAttribute("status");h("private"==e&&d!=e&&(0,i.sprintf)(De,3)),w()}));return(0,c.useEffect)((()=>{if(!p)return void s("upgrade-notice");const e={label:(0,i.__)("Upgrade your license","mailster"),variant:"primary",onClick:()=>window.open(window.location.origin+window.location.pathname.replace("post.php","edit.php")+"?page=mailster-pricing&utm_campaign=plugin-upgrade&utm_medium=editor+notice")};t("warning",p,{id:"upgrade-notice",isDismissible:!0,actions:[e]})}),[p]),(0,z.jsx)(m.Button,{onClick:()=>{f(g?"private":"publish"),r({status:g?"private":"publish"})},icon:g?qe:Ve,variant:"secondary",isDestructive:!g,children:g?(0,i.__)("Workflow is Active","mailster"):(0,i.__)("Workflow is Inactive","mailster")})}Y().then((e=>{e.addEventListener("popstate",Ue),Ue()}));const Ue=()=>{Y().then((e=>{const t=location.hash.match(/#step-([a-z0-9]+)/);if(t){const s=e.document.querySelector(".mailster-step-"+t[1]);s&&(0,u.dispatch)("core/block-editor").flashBlock(s.dataset.block),s&&(0,u.dispatch)("core/block-editor").selectBlock(s.dataset.block),s&&s.scrollIntoView()}}))};(0,l.registerPlugin)("mailster-automation-settings-panel",{render:function(){(0,u.select)("core/block-editor").getBlocks();const[e,t]=(0,c.useState)([]),s=e.length,r=(0,u.useSelect)((e=>e("mailster/automation").getNumbers())),n=r?r.finished:0,l=r?r.active:0,d=r?r.total:0,[f,p]=(0,c.useState)(!0),[h,g]=function(e){const t=(0,c.useRef)(e),[s,r]=(0,c.useState)(e===window),n=(0,c.useCallback)((()=>{r(!0)}),[s]),o=(0,c.useCallback)((()=>{r(!1)}),[s]);return(0,c.useEffect)((()=>{const e=t.current;return e?.addEventListener("focus",n),e?.addEventListener("blur",o),()=>{e?.removeEventListener("focus",n),e?.removeEventListener("blur",o)}})),[t,s]}(window);f&&K((()=>{J("getQueue","mailster/automation")}),g?2e3:2e4,g),f&&K((()=>{J("getCampaignStats","mailster/automation"),J("getNumbers","mailster/automation")}),g?15e3:3e4,g),(0,c.useEffect)((()=>{const e=document.querySelectorAll(".editor-header > div");if(!e)return;const t=document.querySelector(".edit-post-visual-editor"),s=document.createElement("div");s.className="interface-interface-canvas-toolbar";const r=document.createElement("div");r.className="edit-post-header-toolbar-extra",document.querySelector(".edit-post-header-toolbar-extra")||(e[e.length-1].prepend(r),t.prepend(s),(0,c.createRoot)(s).render((0,z.jsx)(Oe,{})),(0,c.createRoot)(r).render((0,z.jsx)(We,{})))}),[]),$((()=>{const e=Z("mailster-workflow/triggers");if(e.length)e.length>1&&e.slice(1).map((e=>{(0,u.dispatch)("core/block-editor").updateBlockAttributes(e.clientId,{lock:!1}),(0,u.dispatch)("core/block-editor").removeBlock(e.clientId)}));else{const e=(0,o.createBlock)("mailster-workflow/triggers");(0,u.dispatch)("core/block-editor").insertBlock(e,0)}}));const[w,_]=(0,c.useState)();return $((()=>{Y().then((e=>{const t=(e,s,r=0)=>[...e.querySelectorAll(s)].reduce(((e,n)=>Math.max(e,t(n,s,r+1))),r);X("mailster-workflow/conditions")?_(t(e.document.querySelector(".is-root-container"),".mailster-step-conditions")):_(0)}))})),(0,c.useEffect)((()=>{Y().then((e=>{const t=e.document.querySelector(".editor-styles-wrapper");t&&(t.style.minWidth=800*w+"px")}))}),[w]),(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Pe,{}),(0,z.jsx)(a.PluginPrePublishPanel,{className:"my-plugin-pre-publish-panel",initialOpen:!0,children:(0,z.jsx)(m.PanelRow,{children:(0,z.jsx)(m.BaseControl,{__nextHasNoMarginBottom:!0,children:!!s&&(0,z.jsxs)("div",{children:[(0,z.jsx)("span",{className:"number",children:s}),(0,z.jsx)("span",{className:"label",children:(0,i.__)("Invalid Steps","mailster")})]})})})}),(0,z.jsx)(Be,{}),(0,z.jsx)(a.PluginPostStatusInfo,{className:"status-numbers",children:(0,z.jsxs)(m.Flex,{align:"center",justify:"space-between",children:[(0,z.jsxs)(m.FlexItem,{children:[(0,z.jsx)("span",{className:"label",children:(0,i.__)("active","mailster")}),(0,z.jsx)("span",{className:"number",children:l})]}),(0,z.jsxs)(m.FlexItem,{children:[(0,z.jsx)("span",{className:"label",children:(0,i.__)("finished","mailster")}),(0,z.jsx)("span",{className:"number",children:n})]}),(0,z.jsxs)(m.FlexItem,{children:[(0,z.jsx)("span",{className:"label",children:(0,i.__)("total","mailster")}),(0,z.jsx)("span",{className:"number",children:d})]})]})}),(0,z.jsx)(Le,{})]})},icon:!1});var He=s(6942),ze=s.n(He);function Qe(e){const t=(0,u.useSelect)((e=>e("mailster/automation").getTriggers())),s=Z("mailster-workflow/trigger").length-1||0,r=(0,i._n)("There is %d trigger in this workflow.","There are %d triggers in this workflow.",s,"mailster");return(0,z.jsx)(je.InspectorControls,{children:t&&(0,z.jsx)(m.Panel,{children:(0,z.jsx)(m.PanelBody,{children:(0,z.jsx)(m.PanelRow,{children:(0,i.sprintf)(r,s)})})})})}function Ye(e){const{attributes:t,clientId:s,name:r,isSelectionEnabled:n}=e,{isExample:o}=t;if((0,u.useSelect)((e=>{const t=e("core/block-editor").getBlocks();return t.length?t.at(-1).clientId:null}))!==s)return null;const a="mailster-workflow/triggers"===r?(0,i.__)("Click + to add a step","mailster"):(0,i.__)("Workflow Finished","mailster");return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(m.Tooltip,{text:(0,i.__)("Once the user reaches this point the workflow will be finished.","mailster"),children:(0,z.jsx)("span",{className:"workflow-finished "+r.replace("mailster-workflow/","workflow-finished-"),children:!o&&a})}),n&&(0,z.jsx)(je.ButtonBlockAppender,{})]})}const $e=(0,z.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,z.jsx)("path",{fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M9.925 3v6.794l4.661.01L7.66 19.985v-6.794L3 13.181z"})}),Xe=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"mailster-workflow/triggers","title":"Triggers","category":"mailster-workflow-steps","description":"Define how this workflow gets triggered.","example":{},"supports":{"html":false,"reusable":false,"multiple":false,"className":false,"customClassName":false,"inserter":false,"renaming":false,"lock":false},"attributes":{"lock":{"type":"object","default":{"remove":true,"move":true}}},"textdomain":"mailster","editorScript":"file:./index.js","editorStyle":"file:./index.css","style":"file:./style-index.css"}'),{name:Ze,...Je}=Xe;(0,o.registerBlockType)(Ze,{...Je,icon:$e,__experimentalLabel:function(e,{context:t}){const{content:s}=e;return s},edit:function(e){const t=["mailster-step-triggers","canvas-handle"],[s,r]=(0,c.useState)(0),{moveBlockToPosition:n}=(0,u.useDispatch)("core/block-editor"),{getBlockRootClientId:o,getBlocks:i}=(0,u.useSelect)("core/block-editor"),a=i();s&&t.push("mailster-step-count-"+s),(0,c.useEffect)((()=>{const e=document.querySelector(".wp-block-mailster-workflow-triggers");e&&e.scrollIntoView({inline:"center"})}),[]),(0,c.useEffect)((()=>{const e=i()[0];if(e&&"mailster-workflow/triggers"!==e.name){const t=X("mailster-workflow/triggers"),s=o(e.clientId);(0,u.dispatch)("core/block-editor").updateBlockAttributes(t.clientId,{lock:!1}),n(t.clientId,s,s,0)}r(Z("mailster-workflow/trigger").length)}),[a]);const l=(0,je.useInnerBlocksProps)({className:"canvas-handle"},{template:[["mailster-workflow/trigger",{}]],orientation:"horizontal"}),m=(0,je.useBlockProps)({className:ze()({},t)});return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Qe,{...e}),(0,z.jsxs)("div",{...m,children:[(0,z.jsx)("div",{...l}),(0,z.jsx)("div",{className:"wrap-line canvas-handle"})]}),(0,z.jsx)(Ye,{...e,className:"trigger-appender"})]})},save:function(e){return(0,z.jsx)(je.InnerBlocks.Content,{...je.useBlockProps.save()})}})})()})();