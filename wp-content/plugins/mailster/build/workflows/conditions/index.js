(()=>{var e={6942:(e,t)=>{var s;!function(){"use strict";var i={}.hasOwnProperty;function n(){for(var e="",t=0;t<arguments.length;t++){var s=arguments[t];s&&(e=o(e,r(s)))}return e}function r(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return n.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var s in e)i.call(e,s)&&e[s]&&(t=o(t,s));return t}function o(e,t){return t?e?e+" "+t:e+t:e}e.exports?(n.default=n,e.exports=n):void 0===(s=function(){return n}.apply(t,[]))||(e.exports=s)}()}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,s),r.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=window.wp.blocks,t=window.wp.i18n,i=window.wp.blockEditor,n=window.wp.serverSideRender;var r=s.n(n);const o=window.wp.components,a=window.wp.data,l=window.wp.element,c=window.ReactJSXRuntime;function d(e){const{attributes:s,setAttributes:i,help:n="",label:d,title:m}=e,{conditions:h}=s,[u,f]=(0,l.useState)(!1),[p,_]=(0,l.useState)(!1),x=(0,a.useSelect)((e=>e("mailster/automation").getEmails()));return(0,l.useEffect)((()=>{const e=setInterval((function(){const t=document.querySelector(".mailster-conditions");t&&(f(!0),mailster.conditions.init(t),clearInterval(e))}),100);return()=>{clearInterval(e)}})),(0,l.useEffect)((()=>{h&&i({conditions:h.replace("&amp;","&")})}),[h]),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(o.BaseControl,{__nextHasNoMarginBottom:!0,label:d||(0,t.__)("Conditions","mailster"),help:n,children:[h&&(0,c.jsx)(o.PanelRow,{children:(0,c.jsx)(r(),{block:"mailster-workflow/conditions",className:"conditions-preview",attributes:{...s,render:!0,plain:!1,emails:x},EmptyResponsePlaceholder:()=>(0,c.jsx)(o.Spinner,{})})}),(0,c.jsxs)(o.PanelRow,{children:[(0,c.jsx)(o.Button,{variant:"secondary",onClick:()=>_(!0),children:h?(0,t.__)("Change Conditions","mailster"):(0,t.__)("Add Conditions","mailster")}),h&&(0,c.jsx)(o.Button,{variant:"link",isDestructive:!0,onClick:()=>i({conditions:void 0}),children:(0,t.__)("Clear","mailster")})]})]}),p&&(0,c.jsxs)(o.Modal,{title:m||(0,t.__)("Define your conditions for this step","mailster"),className:"mailster-conditions-modal",onRequestClose:()=>_(!1),shouldCloseOnClickOutside:!0,__experimentalhideheader:!0,children:[(0,c.jsx)(r(),{block:"mailster-workflow/conditions",attributes:{...s,emails:x}}),(0,c.jsxs)("div",{className:"modal-conditions-buttons",children:[(0,c.jsx)(o.Button,{variant:"primary",disabled:!u,onClick:()=>{_(!1),i({conditions:mailster.conditions.serialize()})},children:(0,t.__)("Save","mailster")}),(0,c.jsx)(o.Button,{disabled:!u,variant:"secondary",onClick:()=>{_(!1)},children:(0,t.__)("Cancel","mailster")})]})]})]})}function m(e){const{attributes:t,setAttributes:s}=e,{weight:n}=t;return(0,c.jsxs)(i.InspectorControls,{children:[(0,c.jsx)(o.Panel,{children:(0,c.jsx)(o.PanelBody,{children:(0,c.jsx)(d,{...e})})}),!1]})}const h=(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:[(0,c.jsx)("line",{x1:"6.5",y1:"8",x2:"6.5",y2:"16",fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,c.jsx)("circle",{cx:"17.5",cy:"5.5",r:"2.5",fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,c.jsx)("circle",{cx:"6.5",cy:"18.5",r:"2.5",fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,c.jsx)("circle",{cx:"6.5",cy:"5.5",r:"2.5",fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,c.jsx)("path",{d:"M17.5,8h0a4,4,0,0,1-4,4h-3a4,4,0,0,0-4,4h0",fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"})]});var u=s(6942),f=s.n(u);const p=window.wp.apiFetch;var _=s.n(p);const x=window.wp.date,w=(0,x.getSettings)(),j=((0,t.__)("Minute","mailster"),(0,t.__)("Minutes","mailster"),(0,t.__)("Hour","mailster"),(0,t.__)("Hours","mailster"),(0,t.__)("Day","mailster"),(0,t.__)("Days","mailster"),(0,t.__)("Week","mailster"),(0,t.__)("Weeks","mailster"),(0,t.__)("Month","mailster"),(0,t.__)("Months","mailster"),(0,t.__)("Specific Time of the day","mailster"),(0,t.__)("Specific day of the week","mailster"),(0,t.__)("Specific day of the month","mailster"),(0,t.__)("Specific date","mailster"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"1st"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"2nd"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"3rd"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"4th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"5th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"6th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"7th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"8th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"9th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"10th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"11st"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"12nd"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"13rd"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"14th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"15th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"16th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"17th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"18th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"19th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"20th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"21st"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"22nd"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"23rd"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"24th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"25th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"26th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"27th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"28th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"29th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"30th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"31st"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"Last"),w.l10n.weekdays.slice(w.l10n.startOfWeek),w.l10n.weekdays.slice(0,w.l10n.startOfWeek),w.l10n.startOfWeek,w.formats.date),y=w.formats.time;function b({id:e,align:t}){const s=new URL("https://kb.mailster.co/"+e);s.searchParams.set("utm_campaign","plugin"),s.searchParams.set("utm_medium","link"),s.searchParams.set("utm_source","Mailster Plugin"),s.searchParams.set("utm_term","workflow");var i={};return t&&(i.float=t),(0,c.jsx)("a",{className:"mailster-help",href:s.toString(),"data-article":e,style:i})}function k(e){const{attributes:s}=e,{id:n}=s,r=(0,a.useSelect)((e=>e("core/editor").getCurrentPostId()),[]),[d,m]=(0,l.useState)(!1),[h,u]=(0,l.useState)(!1),f=function(e){const t=(0,a.useSelect)((e=>e("mailster/automation").getQueue()),[]),[s,i]=(0,l.useState)(0);return(0,l.useEffect)((()=>{t&&i(t[e]||0)}),[e,t]),s}(n),p=(0,t.sprintf)((0,t._n)("%s subscriber queued","%s subscribers queued",f,"mailster"),f);return(0,l.useEffect)((()=>{if(d&&n&&r)return f?void _()({path:"/mailster/v1/automations/queue/"+r+"/"+n}).then((e=>{u(e)})):u([])}),[d,r,n,f]),(0,c.jsxs)(c.Fragment,{children:[f>0&&(0,c.jsx)("span",{className:"mailster-step-queued",title:p,onClick:()=>m(!0),children:f}),d&&(0,c.jsxs)(o.Modal,{title:p,onRequestClose:()=>m(!1),children:[(0,c.jsx)(b,{id:"66b09cdba62a7505fcf33836",align:"right"}),(0,c.jsxs)("div",{className:"mailster-queue-table",children:[!h&&(0,c.jsx)(o.Panel,{children:(0,c.jsx)(o.PanelBody,{children:(0,c.jsx)(o.PanelRow,{children:(0,c.jsx)(o.Spinner,{})})})}),h&&(0,c.jsx)(g,{data:h,setData:u,...e})]}),(0,c.jsx)(o.Tip,{children:(0,t.__)("This table shows you the subscribers which are currently queued in this step. You can finish, trash or move them to the next step with the action buttons.","mailster")})]}),(0,c.jsx)(i.InspectorControls,{children:f>0&&(0,c.jsxs)(o.Panel,{children:[(0,c.jsxs)(o.PanelBody,{title:(0,t.__)("Queue","mailster"),children:[(0,c.jsx)(b,{id:"66b09cdba62a7505fcf33836",align:"right"}),(0,c.jsx)(o.PanelRow,{children:(0,c.jsx)(o.Button,{onClick:()=>m(!0),variant:"secondary",children:p})})]}),(0,c.jsx)(o.PanelBody,{children:(0,c.jsx)(o.Tip,{children:(0,t.__)("Subscribers who are already queued in this step will not be affected by any changes you make.","mailster")})})]})})]})}w.formats.datetime,w.formats.time.match(/[a|A]/),window.lodash,window.moment;const g=e=>{const{attributes:s,data:i,setData:n}=e,{id:r}=s,[d,m]=(0,l.useState)(!1),h=(0,a.useSelect)((e=>e("core/editor").getCurrentPostId()),[]),u=(e,t,s,o)=>{const l="/mailster/v1/automations/queue/"+h+"/"+r+"/"+e.ID;m(!0),_()({path:l,method:s,data:o}).then((e=>{e&&n(i.filter(((e,s)=>s!==t))),m(!1),(0,a.dispatch)("mailster/automation").invalidateResolutionForStoreSelector("getQueue")}))},f=(new Date).getTime(),p=i.map(((e,i)=>{const n=1e3*e.timestamp,r=1e3*e.added;return(0,c.jsxs)("tr",{children:[(0,c.jsxs)("td",{children:[(0,c.jsx)(o.ExternalLink,{href:"edit.php?post_type=newsletter&page=mailster_subscribers&ID="+e.subscriber_id,children:e.email}),0==e.status&&(0,c.jsx)("p",{className:"description",children:(0,t.__)("This subscriber hasn't confirmed their subscription yet. The workflow will continue once the user confirms their subscriptions.","mailster")})]}),(0,c.jsx)("td",{children:e.trigger}),(0,c.jsx)("td",{children:r&&(0,c.jsx)(o.Tooltip,{text:(0,x.dateI18n)(j,r)+" @ "+(0,x.dateI18n)(y,r),children:(0,c.jsx)("div",{children:(0,x.humanTimeDiff)(r)})})}),(0,c.jsx)("td",{children:n&&(0,c.jsx)(o.Tooltip,{text:(0,x.dateI18n)(j,n)+" @ "+(0,x.dateI18n)(y,n),children:(0,c.jsx)("div",{children:n>f?(0,x.humanTimeDiff)(n):(0,t.__)("right now","mailster")})})}),(0,c.jsxs)("td",{children:[(0,c.jsx)(o.Button,{icon:"flag",disabled:d,label:(0,t.__)("Finish Journey","mailster"),onClick:()=>((e,s)=>{const i=(0,t.sprintf)((0,t.__)("Do you really like to finish the journey for %s?","mailster"),e.email);confirm(i)&&u(e,s,"POST",{finish:!0})})(e,i)}),(0,c.jsx)(o.Button,{icon:"controls-skipforward",disabled:d||1!=e.status||s.disabled,label:(0,t.__)("Forward to next step","mailster"),onClick:()=>((e,s)=>{const i=(0,t.sprintf)((0,t.__)("Do you really like to forward %s to the next step?","mailster"),e.email);confirm(i)&&u(e,s,"POST",{forward:!0})})(e,i)}),(0,c.jsx)(o.Button,{icon:"trash",disabled:d,isDestructive:!0,label:(0,t.__)("Remove entry","mailster"),onClick:()=>((e,s)=>{const i=(0,t.sprintf)((0,t.__)("Do you really like to remove %s from the queue?","mailster"),e.email);confirm(i)&&u(e,s,"DELETE")})(e,i)})]})]},i)}));return(0,c.jsxs)("table",{className:"wp-list-table widefat striped",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{children:(0,t.__)("Subscriber","mailster")}),(0,c.jsx)("th",{children:(0,t.__)("Trigger","mailster")}),(0,c.jsx)("th",{children:(0,t.__)("Added","mailster")}),(0,c.jsx)("th",{children:(0,t.__)("Continues","mailster")}),(0,c.jsx)("th",{style:{width:"150px"},children:(0,t.__)("Actions","mailster")})]})}),(0,c.jsx)("tbody",{children:p})]})},v={label:(0,t.__)("Skip Step","mailster"),help:(0,t.__)("Skip this step when the workflow is executed.","mailster")},S={label:(0,t.__)("Skip Trigger","mailster"),help:(0,t.__)("Disable this trigger for the workflow.","mailster")};function C(e){const{attributes:t,setAttributes:s,name:n}=e,{disabled:r=!1}=t;if("mailster-workflow/stop"===n)return null;const a="mailster-workflow/trigger"==n?S:v;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(i.BlockControls,{group:"other",children:(0,c.jsx)(o.ToolbarButton,{icon:r?"hidden":"visibility",isPressed:r,title:a.label,onClick:()=>s({disabled:!r||void 0})})}),(0,c.jsx)(i.InspectorControls,{children:(0,c.jsx)(o.Panel,{children:(0,c.jsx)(o.PanelBody,{children:(0,c.jsx)(o.PanelRow,{children:(0,c.jsx)(o.ToggleControl,{__nextHasNoMarginBottom:!0,icon:r?"hidden":"visibility",label:a.label,help:a.help,checked:r,onChange:e=>s({disabled:!!e||void 0})})})})})})]})}function P(e){const{attributes:s,setAttributes:n,name:r}=e,{comment:a=""}=s;return"mailster-workflow/trigger"===r?null:(0,c.jsxs)(c.Fragment,{children:[a&&(0,c.jsx)("div",{className:"mailster-step-comment",children:a}),(0,c.jsx)(i.InspectorControls,{children:(0,c.jsx)(o.Panel,{children:(0,c.jsx)(o.PanelBody,{children:(0,c.jsx)(o.PanelRow,{children:(0,c.jsx)(o.TextControl,{__nextHasNoMarginBottom:!0,label:(0,t.__)("Comment","mailster"),help:(0,t.__)("Add a comment to help you understand your workflow.","mailster"),value:a,onChange:e=>n({comment:e||void 0})})})})})})]})}function B(e){const{attributes:s}=e,{id:n}=s;if(n)return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("span",{className:"mailster-step-id",title:sprintf((0,t.__)("Step ID : %s","mailster"),n),children:n}),(0,c.jsx)(i.InspectorControls,{children:(0,c.jsx)(o.Panel,{children:(0,c.jsx)(o.PanelBody,{className:"code",children:sprintf((0,t.__)("Step ID : %s","mailster"),n)})})})]})}function I(e){const{attributes:s,clientId:n,name:r,isSelectionEnabled:l}=e,{isExample:d}=s;if((0,a.useSelect)((e=>{const t=e("core/block-editor").getBlocks();return t.length?t.at(-1).clientId:null}))!==n)return null;const m="mailster-workflow/triggers"===r?(0,t.__)("Click + to add a step","mailster"):(0,t.__)("Workflow Finished","mailster");return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(o.Tooltip,{text:(0,t.__)("Once the user reaches this point the workflow will be finished.","mailster"),children:(0,c.jsx)("span",{className:"workflow-finished "+r.replace("mailster-workflow/","workflow-finished-"),children:!d&&m})}),l&&(0,c.jsx)(i.ButtonBlockAppender,{})]})}function N(e){const{attributes:t,setAttributes:s,children:n,className:r=[],hasStepId:d=!0,before:m,after:h,inspectorControls:u,isSelected:p,isIncomplete:_,clientId:x,blockAttributes:w={},isSelectionEnabled:j}=e,{id:y,disabled:b=!1}=t;!function(e){const[t,s]=(0,l.useState)();(0,l.useEffect)((()=>{new Promise((e=>{const t=(0,a.subscribe)((()=>{if((0,a.select)("core/editor").isCleanNewPost()||(0,a.select)("core/block-editor").getBlockCount()>0){const s=document.querySelector('iframe[name="editor-canvas"]'),i=s?s.contentWindow:window,n=()=>{i.removeEventListener("load",n),t(),e(i)};i.document.querySelector(".is-root-container")?n():i.addEventListener("load",n)}}))})).then((t=>{s(t.document),e&&e(t.document)}))}),[])}((e=>{e&&d&&(!y||e.querySelectorAll(".mailster-step-"+y).length>1)&&s({id:x.substring(30)})})),(0,l.useEffect)((()=>{if(p&&y)return history.replaceState(void 0,void 0,"#step-"+y),()=>{history.pushState("",document.title,location.pathname+location.search)}}),[p]);const g=(0,l.useRef)();y&&r.push("mailster-step-"+y),_&&j&&r.push("mailster-step-incomplete"),b&&r.push("mailster-step-disabled");const v=(0,i.useBlockProps)({className:f()({},r),...w});return(0,c.jsxs)(c.Fragment,{children:[u,(0,c.jsxs)("div",{...v,children:[m,(0,c.jsxs)(o.Card,{className:"mailster-step",ref:g,children:[(0,c.jsx)(P,{...e}),(0,c.jsx)(C,{...e}),(0,c.jsx)(k,{...e}),(0,c.jsx)(B,{...e}),(0,c.jsx)("div",{className:"mailster-step-inner",children:n})]}),h,(0,c.jsx)("div",{className:"end-stop canvas-handle"})]}),(0,c.jsx)(I,{...e})]})}const D=[["mailster-workflow/condition-yes"],["mailster-workflow/condition-no"]],T=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"mailster-workflow/conditions","title":"Condition","category":"mailster-workflow-steps","keywords":["container","wrapper","row","section"],"parent":["core/post-content","mailster-workflow/condition-yes","mailster-workflow/condition-no"],"description":"Define a condition and branch of your path.","example":{},"supports":{"html":false,"className":false,"customClassName":false},"attributes":{"id":{"type":"string"},"disabled":{"type":"boolean"},"weight":{"type":"float","default":0.5},"comment":{"type":"string"},"emails":{"type":"array"},"conditions":{"type":"string"},"render":{"type":"boolean"},"plain":{"type":"boolean"}},"providesContext":{"mailster-workflow/weight":"weight"},"textdomain":"mailster","editorScript":"file:./index.js","editorStyle":"file:./index.css","style":"file:./style-index.css"}'),{name:E,...L}=T;(0,e.registerBlockType)(E,{...L,icon:h,edit:function(e){const{attributes:s,setAttributes:n,isSelected:l,clientId:d}=e,{id:u,comment:f,conditions:p,weight:_}=s,x=(0,a.useSelect)((e=>e("mailster/automation").getEmails())),w="translateX("+-100*(.5-_)+"%)",j=(0,i.useInnerBlocksProps)({className:"canvas-handle",style:{transform:w}},{template:D,templateLock:"all"}),y=(0,t.__)("Check if","mailster");return(0,c.jsx)(N,{...e,className:["mailster-step-conditions","canvas-handle"],after:(0,c.jsx)("div",{...j}),isIncomplete:!p,inspectorControls:(0,c.jsx)(m,{...e}),children:(0,c.jsxs)(o.CardBody,{children:[(0,c.jsxs)("div",{className:"mailster-step-label",children:[(0,c.jsx)(o.Icon,{icon:h}),y]}),(0,c.jsxs)("div",{className:"mailster-step-info",children:[p&&(0,c.jsx)(r(),{block:"mailster-workflow/conditions",attributes:{...s,render:!0,plain:!0,emails:x},EmptyResponsePlaceholder:()=>(0,c.jsx)(o.Spinner,{})}),!p&&(0,t.__)("Define a condition","mailster")]})]})})},save:function(e){return(0,c.jsx)(i.InnerBlocks.Content,{...i.useBlockProps.save()})}})})()})();