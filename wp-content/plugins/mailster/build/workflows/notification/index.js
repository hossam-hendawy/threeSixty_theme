(()=>{var e={6942:(e,t)=>{var s;!function(){"use strict";var i={}.hasOwnProperty;function r(){for(var e="",t=0;t<arguments.length;t++){var s=arguments[t];s&&(e=o(e,n(s)))}return e}function n(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return r.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var s in e)i.call(e,s)&&e[s]&&(t=o(t,s));return t}function o(e,t){return t?e?e+" "+t:e+t:e}e.exports?(r.default=r,e.exports=r):void 0===(s=function(){return r}.apply(t,[]))||(e.exports=s)}()}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,s),n.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=window.wp.blocks,t=window.wp.i18n,i=window.wp.components,r=window.wp.blockEditor,n=window.wp.element,o=window.wp.data,a=(window.lodash,window.moment,window.ReactJSXRuntime);function l({id:e,align:t}){const s=new URL("https://kb.mailster.co/"+e);s.searchParams.set("utm_campaign","plugin"),s.searchParams.set("utm_medium","link"),s.searchParams.set("utm_source","Mailster Plugin"),s.searchParams.set("utm_term","workflow");var i={};return t&&(i.float=t),(0,a.jsx)("a",{className:"mailster-help",href:s.toString(),"data-article":e,style:i})}function d(e){const{attributes:s,setAttributes:d}=e,{id:c,email:m,subject:h,message:u}=s,f=(0,o.useSelect)((e=>e("core").getCurrentUser()),[]),p=(0,o.useSelect)((e=>{if(f)return e("core").getUser(f.id)}),[f]);return(0,n.useEffect)((()=>{!m&&p&&d({email:p.email})}),[p]),(0,n.useEffect)((()=>{c&&(!h&&d({subject:(0,t.sprintf)((0,t.__)("Step #%s reached!","mailster"),c)}),!u&&d({message:(0,t.sprintf)((0,t.__)("Step #%s has been reached!","mailster"),c)}))}),[c,h,u]),(0,a.jsx)(r.InspectorControls,{children:(0,a.jsx)(i.Panel,{children:(0,a.jsxs)(i.PanelBody,{children:[(0,a.jsx)(l,{id:"66336f5b0cfcb4508af6ae55",align:"right"}),(0,a.jsx)(i.TextControl,{__nextHasNoMarginBottom:!0,label:(0,t.__)("Email","mailster"),type:"email",value:m,onChange:e=>{d({email:e})},help:(0,t.__)("Define an email address for the notification.","mailster"),placeholder:(0,t.__)("Add email","mailster")}),(0,a.jsx)(i.TextControl,{__nextHasNoMarginBottom:!0,label:(0,t.__)("Subject","mailster"),type:"subject",value:h,onChange:e=>{d({subject:e})},help:(0,t.__)("Set a subject.","mailster"),placeholder:(0,t.__)("Add subject","mailster")}),(0,a.jsx)(i.TextareaControl,{label:(0,t.__)("Message","mailster"),type:"message",rows:10,value:u,onChange:e=>{d({message:e})},help:(0,t.__)("Set a message.","mailster"),placeholder:(0,t.__)("Add message","mailster")}),(0,a.jsx)(i.Tip,{children:(0,t.sprintf)((0,t.__)("You can use placeholders like %s or %s to add subscriber data to your message.","mailster"),"{firstname}","{lastname}")})]})})})}const c=(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:[(0,a.jsx)("line",{x1:"21",y1:"3.5",x2:"20.0213",y2:"4.15246",fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,a.jsx)("line",{x1:"22",y1:"9",x2:"21.0213",y2:"9",fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,a.jsx)("line",{x1:"3",y1:"3.5",x2:"3.9787",y2:"4.15246",fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,a.jsx)("line",{x1:"2",y1:"9",x2:"2.9787",y2:"9",fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,a.jsx)("path",{d:"M14,20a2.5,2.5,0,0,1-4,0",fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,a.jsx)("path",{d:"M6.375,13.05244V9.625A5.625,5.625,0,0,1,12,4h0a5.625,5.625,0,0,1,5.625,5.625v3.42745h-.00425l1.29,1.291a2,2,0,0,1-1.41512,3.41366H6.50437a2,2,0,0,1-1.41512-3.41366l1.29-1.291",fill:"none",stroke:"#323232",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,a.jsx)("path",{d:"M0,0H24V24H0Z",fill:"none"})]});var m=s(6942),h=s.n(m);const u=window.wp.apiFetch;var f=s.n(u);const p=window.wp.date,_=(0,p.getSettings)(),x=((0,t.__)("Minute","mailster"),(0,t.__)("Minutes","mailster"),(0,t.__)("Hour","mailster"),(0,t.__)("Hours","mailster"),(0,t.__)("Day","mailster"),(0,t.__)("Days","mailster"),(0,t.__)("Week","mailster"),(0,t.__)("Weeks","mailster"),(0,t.__)("Month","mailster"),(0,t.__)("Months","mailster"),(0,t.__)("Specific Time of the day","mailster"),(0,t.__)("Specific day of the week","mailster"),(0,t.__)("Specific day of the month","mailster"),(0,t.__)("Specific date","mailster"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"1st"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"2nd"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"3rd"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"4th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"5th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"6th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"7th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"8th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"9th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"10th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"11st"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"12nd"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"13rd"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"14th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"15th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"16th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"17th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"18th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"19th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"20th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"21st"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"22nd"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"23rd"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"24th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"25th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"26th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"27th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"28th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"29th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"30th"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"31st"),(0,t.sprintf)((0,t.__)("%s day of the month","mailster"),"Last"),_.l10n.weekdays.slice(_.l10n.startOfWeek),_.l10n.weekdays.slice(0,_.l10n.startOfWeek),_.l10n.startOfWeek,_.formats.date),j=_.formats.time;function y(e){const{attributes:s}=e,{id:d}=s,c=(0,o.useSelect)((e=>e("core/editor").getCurrentPostId()),[]),[m,h]=(0,n.useState)(!1),[u,p]=(0,n.useState)(!1),_=function(e){const t=(0,o.useSelect)((e=>e("mailster/automation").getQueue()),[]),[s,i]=(0,n.useState)(0);return(0,n.useEffect)((()=>{t&&i(t[e]||0)}),[e,t]),s}(d),x=(0,t.sprintf)((0,t._n)("%s subscriber queued","%s subscribers queued",_,"mailster"),_);return(0,n.useEffect)((()=>{if(m&&d&&c)return _?void f()({path:"/mailster/v1/automations/queue/"+c+"/"+d}).then((e=>{p(e)})):p([])}),[m,c,d,_]),(0,a.jsxs)(a.Fragment,{children:[_>0&&(0,a.jsx)("span",{className:"mailster-step-queued",title:x,onClick:()=>h(!0),children:_}),m&&(0,a.jsxs)(i.Modal,{title:x,onRequestClose:()=>h(!1),children:[(0,a.jsx)(l,{id:"66b09cdba62a7505fcf33836",align:"right"}),(0,a.jsxs)("div",{className:"mailster-queue-table",children:[!u&&(0,a.jsx)(i.Panel,{children:(0,a.jsx)(i.PanelBody,{children:(0,a.jsx)(i.PanelRow,{children:(0,a.jsx)(i.Spinner,{})})})}),u&&(0,a.jsx)(b,{data:u,setData:p,...e})]}),(0,a.jsx)(i.Tip,{children:(0,t.__)("This table shows you the subscribers which are currently queued in this step. You can finish, trash or move them to the next step with the action buttons.","mailster")})]}),(0,a.jsx)(r.InspectorControls,{children:_>0&&(0,a.jsxs)(i.Panel,{children:[(0,a.jsxs)(i.PanelBody,{title:(0,t.__)("Queue","mailster"),children:[(0,a.jsx)(l,{id:"66b09cdba62a7505fcf33836",align:"right"}),(0,a.jsx)(i.PanelRow,{children:(0,a.jsx)(i.Button,{onClick:()=>h(!0),variant:"secondary",children:x})})]}),(0,a.jsx)(i.PanelBody,{children:(0,a.jsx)(i.Tip,{children:(0,t.__)("Subscribers who are already queued in this step will not be affected by any changes you make.","mailster")})})]})})]})}_.formats.datetime,_.formats.time.match(/[a|A]/);const b=e=>{const{attributes:s,data:r,setData:l}=e,{id:d}=s,[c,m]=(0,n.useState)(!1),h=(0,o.useSelect)((e=>e("core/editor").getCurrentPostId()),[]),u=(e,t,s,i)=>{const n="/mailster/v1/automations/queue/"+h+"/"+d+"/"+e.ID;m(!0),f()({path:n,method:s,data:i}).then((e=>{e&&l(r.filter(((e,s)=>s!==t))),m(!1),(0,o.dispatch)("mailster/automation").invalidateResolutionForStoreSelector("getQueue")}))},_=(new Date).getTime(),y=r.map(((e,r)=>{const n=1e3*e.timestamp,o=1e3*e.added;return(0,a.jsxs)("tr",{children:[(0,a.jsxs)("td",{children:[(0,a.jsx)(i.ExternalLink,{href:"edit.php?post_type=newsletter&page=mailster_subscribers&ID="+e.subscriber_id,children:e.email}),0==e.status&&(0,a.jsx)("p",{className:"description",children:(0,t.__)("This subscriber hasn't confirmed their subscription yet. The workflow will continue once the user confirms their subscriptions.","mailster")})]}),(0,a.jsx)("td",{children:e.trigger}),(0,a.jsx)("td",{children:o&&(0,a.jsx)(i.Tooltip,{text:(0,p.dateI18n)(x,o)+" @ "+(0,p.dateI18n)(j,o),children:(0,a.jsx)("div",{children:(0,p.humanTimeDiff)(o)})})}),(0,a.jsx)("td",{children:n&&(0,a.jsx)(i.Tooltip,{text:(0,p.dateI18n)(x,n)+" @ "+(0,p.dateI18n)(j,n),children:(0,a.jsx)("div",{children:n>_?(0,p.humanTimeDiff)(n):(0,t.__)("right now","mailster")})})}),(0,a.jsxs)("td",{children:[(0,a.jsx)(i.Button,{icon:"flag",disabled:c,label:(0,t.__)("Finish Journey","mailster"),onClick:()=>((e,s)=>{const i=(0,t.sprintf)((0,t.__)("Do you really like to finish the journey for %s?","mailster"),e.email);confirm(i)&&u(e,s,"POST",{finish:!0})})(e,r)}),(0,a.jsx)(i.Button,{icon:"controls-skipforward",disabled:c||1!=e.status||s.disabled,label:(0,t.__)("Forward to next step","mailster"),onClick:()=>((e,s)=>{const i=(0,t.sprintf)((0,t.__)("Do you really like to forward %s to the next step?","mailster"),e.email);confirm(i)&&u(e,s,"POST",{forward:!0})})(e,r)}),(0,a.jsx)(i.Button,{icon:"trash",disabled:c,isDestructive:!0,label:(0,t.__)("Remove entry","mailster"),onClick:()=>((e,s)=>{const i=(0,t.sprintf)((0,t.__)("Do you really like to remove %s from the queue?","mailster"),e.email);confirm(i)&&u(e,s,"DELETE")})(e,r)})]})]},r)}));return(0,a.jsxs)("table",{className:"wp-list-table widefat striped",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:(0,t.__)("Subscriber","mailster")}),(0,a.jsx)("th",{children:(0,t.__)("Trigger","mailster")}),(0,a.jsx)("th",{children:(0,t.__)("Added","mailster")}),(0,a.jsx)("th",{children:(0,t.__)("Continues","mailster")}),(0,a.jsx)("th",{style:{width:"150px"},children:(0,t.__)("Actions","mailster")})]})}),(0,a.jsx)("tbody",{children:y})]})},w={label:(0,t.__)("Skip Step","mailster"),help:(0,t.__)("Skip this step when the workflow is executed.","mailster")},g={label:(0,t.__)("Skip Trigger","mailster"),help:(0,t.__)("Disable this trigger for the workflow.","mailster")};function k(e){const{attributes:t,setAttributes:s,name:n}=e,{disabled:o=!1}=t;if("mailster-workflow/stop"===n)return null;const l="mailster-workflow/trigger"==n?g:w;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.BlockControls,{group:"other",children:(0,a.jsx)(i.ToolbarButton,{icon:o?"hidden":"visibility",isPressed:o,title:l.label,onClick:()=>s({disabled:!o||void 0})})}),(0,a.jsx)(r.InspectorControls,{children:(0,a.jsx)(i.Panel,{children:(0,a.jsx)(i.PanelBody,{children:(0,a.jsx)(i.PanelRow,{children:(0,a.jsx)(i.ToggleControl,{__nextHasNoMarginBottom:!0,icon:o?"hidden":"visibility",label:l.label,help:l.help,checked:o,onChange:e=>s({disabled:!!e||void 0})})})})})})]})}function v(e){const{attributes:s,setAttributes:n,name:o}=e,{comment:l=""}=s;return"mailster-workflow/trigger"===o?null:(0,a.jsxs)(a.Fragment,{children:[l&&(0,a.jsx)("div",{className:"mailster-step-comment",children:l}),(0,a.jsx)(r.InspectorControls,{children:(0,a.jsx)(i.Panel,{children:(0,a.jsx)(i.PanelBody,{children:(0,a.jsx)(i.PanelRow,{children:(0,a.jsx)(i.TextControl,{__nextHasNoMarginBottom:!0,label:(0,t.__)("Comment","mailster"),help:(0,t.__)("Add a comment to help you understand your workflow.","mailster"),value:l,onChange:e=>n({comment:e||void 0})})})})})})]})}function S(e){const{attributes:s}=e,{id:n}=s;if(n)return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"mailster-step-id",title:sprintf((0,t.__)("Step ID : %s","mailster"),n),children:n}),(0,a.jsx)(r.InspectorControls,{children:(0,a.jsx)(i.Panel,{children:(0,a.jsx)(i.PanelBody,{className:"code",children:sprintf((0,t.__)("Step ID : %s","mailster"),n)})})})]})}function C(e){const{attributes:s,clientId:n,name:l,isSelectionEnabled:d}=e,{isExample:c}=s;if((0,o.useSelect)((e=>{const t=e("core/block-editor").getBlocks();return t.length?t.at(-1).clientId:null}))!==n)return null;const m="mailster-workflow/triggers"===l?(0,t.__)("Click + to add a step","mailster"):(0,t.__)("Workflow Finished","mailster");return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Tooltip,{text:(0,t.__)("Once the user reaches this point the workflow will be finished.","mailster"),children:(0,a.jsx)("span",{className:"workflow-finished "+l.replace("mailster-workflow/","workflow-finished-"),children:!c&&m})}),d&&(0,a.jsx)(r.ButtonBlockAppender,{})]})}function P(e){const{attributes:t,setAttributes:s,children:l,className:d=[],hasStepId:c=!0,before:m,after:u,inspectorControls:f,isSelected:p,isIncomplete:_,clientId:x,blockAttributes:j={},isSelectionEnabled:b}=e,{id:w,disabled:g=!1}=t;!function(e){const[t,s]=(0,n.useState)();(0,n.useEffect)((()=>{new Promise((e=>{const t=(0,o.subscribe)((()=>{if((0,o.select)("core/editor").isCleanNewPost()||(0,o.select)("core/block-editor").getBlockCount()>0){const s=document.querySelector('iframe[name="editor-canvas"]'),i=s?s.contentWindow:window,r=()=>{i.removeEventListener("load",r),t(),e(i)};i.document.querySelector(".is-root-container")?r():i.addEventListener("load",r)}}))})).then((t=>{s(t.document),e&&e(t.document)}))}),[])}((e=>{e&&c&&(!w||e.querySelectorAll(".mailster-step-"+w).length>1)&&s({id:x.substring(30)})})),(0,n.useEffect)((()=>{if(p&&w)return history.replaceState(void 0,void 0,"#step-"+w),()=>{history.pushState("",document.title,location.pathname+location.search)}}),[p]);const P=(0,n.useRef)();w&&d.push("mailster-step-"+w),_&&b&&d.push("mailster-step-incomplete"),g&&d.push("mailster-step-disabled");const N=(0,r.useBlockProps)({className:h()({},d),...j});return(0,a.jsxs)(a.Fragment,{children:[f,(0,a.jsxs)("div",{...N,children:[m,(0,a.jsxs)(i.Card,{className:"mailster-step",ref:P,children:[(0,a.jsx)(v,{...e}),(0,a.jsx)(k,{...e}),(0,a.jsx)(y,{...e}),(0,a.jsx)(S,{...e}),(0,a.jsx)("div",{className:"mailster-step-inner",children:l})]}),u,(0,a.jsx)("div",{className:"end-stop canvas-handle"})]}),(0,a.jsx)(C,{...e})]})}const N=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"mailster-workflow/notification","title":"Notification","category":"mailster-workflow-steps","keywords":["notification","message"],"description":"Send a notification to an email address.","parent":["core/post-content","mailster-workflow/condition-yes","mailster-workflow/condition-no"],"example":{},"supports":{"html":false,"className":false,"customClassName":false},"attributes":{"id":{"type":"string"},"disabled":{"type":"boolean"},"email":{"type":"string","default":""},"subject":{"type":"string","default":""},"message":{"type":"string","default":""},"comment":{"type":"string"}},"textdomain":"mailster","editorScript":"file:./index.js"}'),{name:B,...T}=N;(0,e.registerBlockType)(B,{...T,__experimentalLabel:function(e,{context:s}){const{email:i,content:r,metadata:n}=e;return n?.name?n.name:(0,t.sprintf)((0,t.__)("Send Notification to %s","mailster"),i||"")||r},icon:c,edit:function(e){const{attributes:s,setAttributes:r,isSelected:n}=e,{email:o}=s,l=(0,t.__)("Send notification","mailster");return(0,a.jsx)(P,{...e,isIncomplete:!o,inspectorControls:(0,a.jsx)(d,{...e}),children:(0,a.jsxs)(i.CardBody,{size:"small",children:[(0,a.jsxs)("div",{className:"mailster-step-label",children:[(0,a.jsx)(i.Icon,{icon:c}),l]}),o&&(0,a.jsx)("div",{className:"mailster-step-info",children:(0,t.sprintf)((0,t.__)("to %s","mailster"),o)})]})})},save:()=>null})})()})();