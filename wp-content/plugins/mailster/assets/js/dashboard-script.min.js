mailster=function(l,d,a,c){"use strict";var t=d(c.body).hasClass("mobile"),e=d(c.body).hasClass("index-php"),i=d(".mailster-mb-subscribers"),s=d("#mailster-subscriber-range"),n=d("#subscriber-chart-wrap"),r=d("#subscriber-chart"),o,u,h={responsive:false,legend:false,animationEasing:"easeOutExpo",maintainAspectRatio:false,tooltips:{backgroundColor:"rgba(56,56,56,0.9)",displayColors:false,cornerRadius:2,caretSize:8,callbacks:{label:function(a,t){return l.util.sprintf(l.l10n.dashboard.subscribers,k(a.yLabel))}}},scales:{xAxes:[{ticks:{maxTicksLimit:20},_type:"time",_time:{format:"MM/DD/YYYY HH:mm",round:"day",tooltipFormat:"ll HH:mm"}}],yAxes:[{ticks:{callback:function(a){return v(a,true)}}}]}};if(r.length){u=r[0].getContext("2d")}s.on("change",function(){b()}).trigger("change");!e&&a.postboxes.add_postbox_toggles("newsletter_page_mailster_dashboard");d(c).on("click",".locked",function(){a.location="admin.php?page=mailster_convert"}).on("click",".enable-auto-update",function(){var a=d(this);a.html(l.l10n.dashboard.checking);d.get(this.href,function(){a.remove()});return false}).on("click",".check-for-update",function(){var t=d(this);t.html(l.l10n.dashboard.checking);l.util.ajax("check_for_update",function(a){t.html(l.l10n.dashboard.check_again);if(a.success){t.closest(".postbox")[a.data?"addClass":"removeClass"]("has-update");if(a.data){d(".update-version").html(a.data.version);d(".update-last-check").html(a.data.updated)}}});return false}).one("click",".load-language",function(){var t=d(this);t.html(l.l10n.dashboard.downloading);l.util.ajax("load_language",function(a){if(a.success){t.html(l.l10n.dashboard.reload_page)}});return false});var f=function(e){if(!e){return}var n,i=d(".mailster-mb-"+e),a=i.find(".mailster-mb-select"),t=i.find(".mailster-mb-label"),s=i.find(".mailster-mb-link"),r=s.attr("href");if(!a.length){return}a.on("change",function(){o(d(this).val())}).trigger("change");d(c).on("heartbeat-tick",function(a,t){if(n){o(n,true)}});i.find(".piechart").easyPieChart({animate:1e3,rotate:180,barColor:l.colors.main,trackColor:l.colors.track,lineWidth:9,size:75,lineCap:"butt",onStep:function(a){this.$el.find("span").text(Math.round(a))},onStop:function(a){this.$el.find("span").text(Math.round(a))}});function o(a,t){if(!t){i.addClass("mailster-loading")}l.util.ajax("get_dashboard_data",{type:e,id:a},function(a){var t=a.data.data;s.html(t.name).removeAttr("class").addClass("mailster-mb-link").attr("href",r.replace("%d",t.ID));if(t.status){s.addClass("status-"+t.status)}i.find(".stats-total").html(t.sent_formatted);i.find(".stats-open").data("easyPieChart").update(t.openrate*100);i.find(".stats-clicks").data("easyPieChart").update(t.clickrate*100);i.find(".stats-unsubscribes").data("easyPieChart").update(t.unsubscriberate*100);i.find(".stats-bounces").data("easyPieChart").update(t.bouncerate*100);n=t.ID;i.removeClass("mailster-loading")})}};var m=new f("campaigns");var p=new f("lists");function b(a,t,e,n){i.addClass("mailster-loading");l.util.ajax("get_dashboard_chart",{range:s.val()},function(a){g();i.removeClass("mailster-loading");if(!o){o=new Chart(u,{type:"line",data:a.data.chart,options:h})}})}function g(){o=null;if(r){r.remove()}r=d("<canvas>").prependTo(n);u=r[0].getContext("2d");r.attr({width:n.width(),height:n.height()})}function v(a,t){if(a>=1e6){return(a/1e3).toFixed(1)+"M"}else if(a>=1e3&&!t){return(a/1e3).toFixed(1)+"K"}return!(a%1)?k(a):""}function k(a,t,e,n){a=(a+"").replace(/[^0-9+\-Ee.]/g,"");var i=!isFinite(+a)?0:+a;var s=!isFinite(+t)?0:Math.abs(t);var r=typeof n==="undefined"?",":n;var o=typeof e==="undefined"?".":e;var l="";var d=function(a,t){var e=Math.pow(10,t);return""+(Math.round(a*e)/e).toFixed(t)};l=(s?d(i,s):""+Math.round(i)).split(".");if(l[0].length>3){l[0]=l[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,r)}if((l[1]||"").length<s){l[1]=l[1]||"";l[1]+=new Array(s-l[1].length+1).join("0")}return l.join(o)}return l}(mailster||{},jQuery,window,document);