mailster=function(S,x,A,e){"use strict";S.events.push("documentReady",function(){var e=false,t=x(".useit-nav"),n=x(".useit-tab"),i=x("#ID").val(),o=x("#form_form"),a=x("#form-builder"),r=x("#form-structure"),c=x("#form-fields");o.on("submit",function(){A.onbeforeunload=null});x("#use-it").on("click",function(){S.util.tb_show(S.l10n.form.useit,"#TB_inline?&width="+Math.min(1200,S.$.window.width()-50)+"&height="+(S.$.window.height()-100)+"&inlineId=useitbox",null);if(e)alert(S.l10n.form.not_saved);return false});t.on("click","a",function(){t.find("li").removeClass("active");n.hide();var e=x(this).parent().addClass("active").find("a").attr("href");x("#tab-"+e.substr(1)).show();return false});n.hide().eq(0).show();a.find(".sortable").sortable({containment:x("#form_form"),connectWith:".sortable",placeholder:"ui-state-highlight",start:function(e,t){a.addClass("dragging")},stop:function(e,t){a.removeClass("dragging")},receive:function(e,t){r.find("input").each(function(){x(this).attr("name",x(this).data("name"))});c.find("input").each(function(){x(this).removeAttr("name")})},update:function(e,t){s()},remove:function(e,t){}});c.on("click",".form-field",function(){x(this).appendTo("#form-structure .form-order");r.find("input").each(function(){x(this).attr("name",x(this).data("name"))});c.find("input").each(function(){x(this).removeAttr("name")})});r.on("click",".submitbutton input",function(e){e.preventDefault();x(this).focus().select()}).on("click",".field-remove",function(e){e.preventDefault();var t=x(this).parent().parent().parent();t.appendTo(c.find("ul"));t.find("input").removeAttr("name")});x.fn.select2&&x(".tags-input").select2({placeholder:S.l10n.form.choose_tags,tags:true,theme:"mailster"});function s(){e=true;A.onbeforeunload=function(){return S.l10n.form.require_save}}var l="",u,d=x("input#style"),f=x(".add-custom-style"),h=x("#custom-style"),p=x("#custom-style-prefix"),m=x("#custom-style-samples"),v=x("#form-design-iframe"),b,g=x(".designnav"),w=x(".designtab"),k=x(".color-field"),y=x("[data-selector]");v.on("load",function(){u=x('<style id="mailster_form_preview_css"></style>').appendTo(v.contents().find("head"));_();v.contents().find("style.mailster-custom-form-css").remove()});f.on("click",function(){var e=x(this).parent().find(".color-field"),t=".mailster-form-"+i+" "+e.data("selector")+"{\n    \n}\n";h.val(h.val()+p.val()+t)});g.on("click","a.nav",function(){g.find("a").removeClass("nav-tab-active");w.hide();var e=x(this).addClass("nav-tab-active").attr("href");x("#"+e.substr(1)).show();return false}).find("a.nav").eq(0).trigger("click");k.wpColorPicker({clear:function(e,t){_()},change:function(e,t){clearTimeout(b);b=setTimeout(function(){_();s()},20)}});x("#themestyle").on("change",function(){v.attr("src",v.attr("src").replace(/&s=(1|0)/,"&s="+(x(this).prop("checked")?1:0)))});h.on("change",function(){_();s()});m.find("option").on("click",function(){h.val(h.val()+p.val()+".mailster-form-"+i+x(this).val()+"{\n    \n}\n");h[0].scrollTop=h[0].scrollHeight});x("#title").on("change",s);x("#form-builder").on("change","input",s);x("#form-options").on("change","input",s).on("change",".mailster_userschoice",function(){var e=x(this).is(":checked");x(this).parent().parent().parent().parent().find("legend.mailster_userschoice_td").hide().eq(e?1:0).show();x(this).parent().parent().find(".mailster_dropdown").prop("disabled",!e);x(this).parent().parent().parent().parent().find(".mailster_precheck").prop("disabled",e?0:1)}).on("change","#redirect-cb",function(){x("#redirect-tf").prop("disabled",!x(this).is(":checked"))}).on("change",".double-opt-in",function(){!parseInt(x(this).val(),10)?x("#double-opt-in-field").slideUp(200):x("#double-opt-in-field").slideDown(200)}).on("change",".vcard",function(){x(this).is(":checked")?x("#vcard-field").slideDown(200):x("#vcard-field").slideUp(200)});function _(){l="";var a={};x.each(y,function(){var e=x(this),t=e.data("selector"),n=e.data("property"),i=e.data("postfix")||"",o=e.val();if(!o)return;a[t]=a[t]||{};a[t][n]=o+i});x.each(a,function(e,t){l+="form.mailster-form.mailster-form-"+i+" "+e+"{\n";x.each(t,function(e,t){l+="\t"+e+": "+t+";\n"});l+="}\n"});l+=h.val().replace(/(<([^>]+)>)/gi,"");u.html(l);d.val(escape(JSON.stringify(a)));v[0].height=v[0].contentWindow.document.body.scrollHeight+"px"}var D=x(".button-options-wrap").find("input"),T=x(".button-preview"),q=x(".code-preview").find("textarea"),C=x(".shortcode-preview").find("input");D.on("change",I);x(".subscriber-button-style").on("change","input",I);q.on("click",function(){x(this).select()});C.on("click",function(){x(this).select()});x(".embed-form-input").on("change",function(){var e=x(this).parent().parent().parent(),t=e.find(".embed-form-input"),n=e.find(".embed-form-output");n.val(S.util.sprintf(n.data("embedcode"),t.eq(0).val(),t.eq(1).val(),t.eq(2).is(":checked")?"&style=1":""))}).eq(0).trigger("change");x(".embed-form-output").on("focus",function(){x(this).select()});x(".form-output").on("focus",function(){x(this).select()});x(".nav-subscriber-button").on("click",function(){I()});function I(){var e=A.mailsterdata.embedcode,t=x("#ID").val(),n=x("#buttonwidth").val()||480,i="[newsletter_button id="+t,o=x("#showcount").prop("checked"),a=x("input[name=subscriber-button-style]:checked").val(),r=x("#ontop").prop("checked"),c=x("input[name=buttonlabel]:checked").val()=="custom",s=c?x("#buttonlabel").val():x("#buttonlabel").attr("placeholder");s=s?s.replace(/(<([^>]+)>)/gi,""):"";a=a+(r?" ontop":"");if(A.MailsterSubscribe&&A.MailsterSubscribe.loaded)A.MailsterSubscribe.destroy();T.html("");e=e.replace("%ID%",t).replace("%SHOWCOUNT%",o?' data-showcount="1"':"").replace("%WIDTH%",n!=480?' data-width="'+n+'"':"").replace("%DESIGN%",a!="default"?' data-design="'+a+'"':"").replace("%LABEL%",s);T.html(e);q.val(e);if(a&&a!="default")i+=' design="'+a+'"';if(c)i+=' label="'+s+'"';if(o)i+=' showcount="'+o+'"';if(n!=480)i+=' width="'+n+'"';i+="]";C.val(i)}});return S}(mailster||{},jQuery,window,document);