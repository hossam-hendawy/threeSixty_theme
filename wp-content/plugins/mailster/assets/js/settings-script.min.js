mailster=function(c,d,i,s){"use strict";var t=d(".mainnav"),n=d("#deliverynav"),a=d(".tab"),l=d("#tab-delivery").find(".subtab"),e=d("#mailster_nonce").val(),o=d("#reserved-tags").data("tags");d("form#mailster-settings-form").on("submit.lock",function(){return false});if(d("#settingsloaded").length){d(".submit-form").prop("disabled",false);d("form#mailster-settings-form").off("submit.lock")}else{c.log("error loading settings page")}n.on("click","a.nav-tab",function(){n.find("a").removeClass("nav-tab-active");l.hide();var e=d(this).addClass("nav-tab-active").attr("href");d("#deliverymethod").val(e.substr(1));d("#subtab-"+e.substr(1)).show();d("input.mailster_sendtest").val(c.l10n.settings.save_to_test).prop("disabled",true);return false});t.on("click","a",function(){t.find("li").removeClass("active");a.hide();var e=d(this).parent().addClass("active").find("a").attr("href");d("#tab-"+e.substr(1)).show();location.hash=e;d("form#mailster-settings-form").attr("action","options.php"+e);if("#authentication"==e){f();p()}r();return false});function r(){if(!c.beacon)return;var t=[];d(".tab:visible").find("[data-article]").each(function(){if(t.length>=9)return;var e=d(this).data("article");if(!e)return;if(t.includes(e))return;t.push(e)});if(t.length){c.beacon("suggest",t)}else{c.beacon("reset")}}d(".click-to-select").on("click",function(e){if(s.selection){var t=s.body.createTextRange();t.moveToElementText(this);t.select()}else if(i.getSelection){var t=s.createRange();t.selectNode(this);i.getSelection().addRange(t)}});d(".static_map").on("change",function(){if(d(this).val()!="google"){d(".static_map_more").hide()}else{d(".static_map_more").show()}});d("#mailster-settings-form").on("click",'a[href^="#"]',function(){t.find('a[href="'+d(this).attr("href")+'"]').trigger("click")});c.events.push("documentReady",function(){location.hash&&t.find('a[href="'+location.hash+'"]').length?t.find('a[href="'+location.hash+'"]').trigger("click"):t.find("a").eq(0).trigger("click")});d(".system_mail").on("change",function(){d('[name="mailster_options[system_mail_template]"]').prop("disabled",d(this).val()==0);d('[name="mailster_options[respect_content_type]"]').prop("disabled",d(this).val()==0)});d("#load_location_db").on("click",function(){var n=d(this),a=d(".geo-ajax-loading").css({visibility:"visible"});d("button").prop("disabled",true);c.util.ajax("load_geo_data",function(e){d("button").prop("disabled",false);a.css({visibility:"hidden"});n.prop("disabled",false).html(e.data.buttontext);if(e.data.update)d("#location_last_update").html(e.data.update);var t=d('<div class="'+(!e.success?"error":"updated")+'"><p>'+e.data.msg+"</p></div>").hide().prependTo(n.parent()).slideDown(200).delay(200).fadeIn().delay(4e3).fadeTo(200,0).delay(200).slideUp(200,function(){t.remove()})},function(e,t,i){d("button").prop("disabled",false);a.css({visibility:"hidden"});n.prop("disabled",false);var s=d('<div class="error"><p>'+t+" "+e.status+": "+i+"</p></div>").hide().prependTo(n.parent()).slideDown(200).delay(200).fadeIn().delay(4e3).fadeTo(200,0).delay(200).slideUp(200,function(){s.remove()})});return false});d(".webversion-bar-checkbox").on("change",function(){d(this).is(":checked")?d("#webversion-bar-options").slideDown(200):d("#webversion-bar-options").slideUp(200)});d("#social-services").on("change",".social-service-dropdown",function(){var e=d(this),t=e.find(":selected"),i=t.data("url");e.next(".social-service-url-field").html('<label><span class="description">'+i.replace("%s",'<input type="text" name="mailster_options[services]['+e.val()+']" value="" class="regular-text">')+"</span></label>").find("input").focus()}).on("click",".social-service-remove",function(){d(this).parent().remove();return false});d(".social-service-add").on("click",function(){d("#social-services").find("li").eq(0).clone().appendTo("#social-services").find("select").val(0).parent().find(".social-service-url-field").empty()});d(".has-archive-check").on("change",function(){d(this).is(":checked")?d(".archive-slug").slideDown(200):d(".archive-slug").slideUp(200)});d(".edit-slug").on("click",function(){d(this).parent().parent().find("span").hide().filter(".edit-slug-area").show().find("input").focus().select()});d(".users-register").on("change",function(){d(this).is(":checked")?d("#"+d(this).data("section")).slideDown(200):d("#"+d(this).data("section")).slideUp(200)});d("#mailster_spf").on("change",function(){d(this).is(":checked")?d(".spf-info").slideDown(200):d(".spf-info").slideUp(200)});d("#mailster_dkim").on("change",function(){d(this).is(":checked")?d(".dkim-info").slideDown(200):d(".dkim-info").slideUp(200)});d(".dkim-enter-keys").on("click",function(){d(".dkim-keys").slideDown();return false});d(".toggle-auto_send_at_once").on("change",function(){d('input[name="mailster_options[send_at_once]"]').prop("disabled",d(this).is(":checked"))});d("#bounce_active").on("change",function(){d(this).is(":checked")?d("#bounce-options").slideDown(200):d("#bounce-options").slideUp(200)});d("#mailster_generate_dkim_keys").on("click",function(){return d("#dkim_keys_active").length&&confirm(c.l10n.settings.create_new_keys);return false});d("input.smtp.secure").on("change",function(){d("#mailster_smtp_port").val(d(this).data("port"))});d("#capabilities-table").on("mouseenter","label",function(){d("#current-cap").stop().html(d(this).attr("title")).css("opacity",1).show()}).on("mouseleave","tbody",function(){d("#current-cap").fadeOut()}).on("change","input.selectall",function(){var e=d(this);d("input.cap-check-"+e.val()).prop("checked",e.prop("checked"))});d(".mailster_sendtest").on("click",function(){var n=d(this),e=n.closest(".mailster-testmail"),a=e.find(".test-ajax-loading").css({visibility:"visible"}),t=e.find("input.mailster-testmail-email").val(),i=d("form#mailster-settings-form").serialize();n.prop("disabled",true);c.util.ajax("send_test",{test:true,formdata:i,basic:true,to:t},function(e){if(e.data.log)e.success?c.log(e.data.log):c.log(e.data.log,"error");a.css({visibility:"hidden"});n.prop("disabled",false);var t=d('<div class="'+(!e.success?"error":"updated")+'"><p>'+e.data.msg+"</p></div>").hide().prependTo(n.parent()).slideDown(200).delay(200).fadeIn().delay(4e3).fadeTo(200,0).delay(200).slideUp(200,function(){t.remove()})},function(e,t,i){a.css({visibility:"hidden"});n.prop("disabled",false);var s=d('<div class="error"><p>'+t+" "+e.status+": "+i+"</p></div>").hide().prependTo(n.parent()).slideDown(200).delay(200).fadeIn().delay(4e3).fadeTo(200,0).delay(200).slideUp(200,function(){s.remove()})})});d(".mailster_bouncetest").on("click",function(){var s=d(this),n=d(".bounce-ajax-loading").css({visibility:"visible"}),a=d(".bouncetest_status").empty().show(),t=d("form#mailster-settings-form").serialize();s.prop("disabled",true);c.util.ajax("bounce_test",{formdata:t},function(e){u(e.data.identifier,1,t,function(){s.prop("disabled",false)})},function(e,t,i){n.css({visibility:"hidden"});s.prop("disabled",false);a.html(t+" "+e.status+": "+i)})});d("input.cron_radio").on("change",function(){d(".cron_opts").hide();d("."+d(this).val()).show()});d(".switch-cron-url").on("click",function(){d(".cron_opts").toggleClass("alternative-cron");return false});d("#mailster_add_tag").on("click",function(){var e=d('<div class="tag"><code>{<input type="text" class="tag-key">}</code> &#10152; <input type="text" class="regular-text tag-value"> <a class="tag-remove">&#10005;</a></div>').insertBefore(d(this));e.find(".tag-key").focus()});d(".tags").on("change",".tag-key",function(){var e=d(this),t=e.parent().parent(),i=m(e.val());if(!i)e.parent().parent().remove();e.val(i);t.find(".tag-value").attr("name","mailster_options[custom_tags]["+i+"]")}).on("click",".tag-remove",function(){d(this).parent().remove();return false});d("#mailster_add_field").on("click",function(){var e=d('<div class="customfield"><a class="customfield-move-up" title="'+c.l10n.settings.move_up+'">&#9650;</a><a class="customfield-move-down" title="'+c.l10n.settings.move_down+'">&#9660;</a><div><span class="label">'+c.l10n.settings.fieldname+':</span><label><input type="text" class="regular-text customfield-name"></label></div><div><span class="label">'+c.l10n.settings.tag+':</span><span><code>{</code><input type="text" class="customfield-key code"><code>}</code></span></div><div><span class="label">'+c.l10n.settings.type+':</span><select class="customfield-type"><option value="textfield">'+c.l10n.settings.textfield+'</option><option value="textarea">'+c.l10n.settings.textarea+'</option><option value="dropdown">'+c.l10n.settings.dropdown+'</option><option value="radio">'+c.l10n.settings.radio+'</option><option value="checkbox">'+c.l10n.settings.checkbox+'</option><option value="date">'+c.l10n.settings.datefield+'</option></select></div><ul class="customfield-additional customfield-dropdown customfield-radio"><li><ul class="customfield-values"><li><span>&nbsp;</span> <span class="customfield-value-box"><input type="text" class="regular-text customfield-value" value=""> <label><input type="radio" value="" title="'+c.l10n.settings.default_selected+'" class="customfield-default" disabled> '+c.l10n.settings.default_field+'</label></span></li></ul><span>&nbsp;</span> <a class="customfield-value-add">'+c.l10n.settings.add_field+'</a></li></ul><div class="customfield-additional customfield-checkbox"><span>&nbsp;</span><label><input type="checkbox" value="1" title="'+c.l10n.settings.default_field+'" class="customfield-default" disabled> '+c.l10n.settings.default_checked+'</label></div><a class="customfield-remove">remove field</a><br></div>').appendTo(d(".customfields").eq(0));e.find(".customfield-name").focus()});d("#sync_list_check").on("change",function(){d("#sync_list").slideToggle(200);d(".sync-button").prop("disabled",true)});d("#sync_list").on("click","#add_sync_item",function(){var e=d(".mailster_syncitem");e.eq(0).clone().insertAfter(e.last()).removeAttr("title").find("select").each(function(){d(this).attr("name",d(this).attr("name").replace("[synclist][0]","[synclist]["+e.length+"]"))});d(".sync-button").prop("disabled",true)}).on("click",".remove-sync-item",function(){d(this).parent().remove();d(".sync-button").prop("disabled",true)}).on("change","select",function(){d(".sync-button").prop("disabled",true)}).on("click","#sync_subscribers_wp",function(e){if(e&&e.originalEvent&&!confirm(c.l10n.settings.sync_subscriber))return false;var t=d(this),s=d(".sync-ajax-loading").css({visibility:"visible"});d(".sync-button").prop("disabled",true);c.util.ajax("sync_all_subscriber",{offset:t.data("offset")},function(e){d(".sync-button").prop("disabled",false);if(e.success&&e.data.count){t.data("offset",e.data.offset).trigger("click")}else{s.css({visibility:"hidden"});t.data("offset",0)}},function(e,t,i){s.css({visibility:"hidden"});d(".sync-button").prop("disabled",false)});return false}).on("click","#sync_wp_subscribers",function(e){if(e&&e.originalEvent&&!confirm(c.l10n.settings.sync_wp_user))return false;var t=d(this),s=d(".sync-ajax-loading").css({visibility:"visible"});d(".sync-button").prop("disabled",true);c.util.ajax("sync_all_wp_user",{offset:t.data("offset")},function(e){d(".sync-button").prop("disabled",false);if(e.success&&e.data.count){t.data("offset",e.data.offset).trigger("click")}else{s.css({visibility:"hidden"});t.data("offset",0)}},function(e,t,i){s.css({visibility:"hidden"});d(".sync-button").prop("disabled",false)});return false});d(".customfields").on("change",".customfield-name",function(){var e=d(this),t=e.parent().parent().parent().find(".customfield-key");if(!t.val())t.val(e.val()).trigger("change")}).on("change",".customfield-key",function(){var e=d(this),t=e.parent().parent().parent(),i=m(e.val());if(!i)t.remove();e.val(i);t.find(".customfield-name").attr("name","mailster_options[custom_field]["+i+"][name]");t.find(".customfield-type").attr("name","mailster_options[custom_field]["+i+"][type]");t.find(".customfield-value").attr("name","mailster_options[custom_field]["+i+"][values][]");t.find(".customfield-default").attr("name","mailster_options[custom_field]["+i+"][default]")}).on("click",".customfield-remove",function(){d(this).parent().remove()}).on("click",".customfield-move-up",function(){var e=d(this).parent();e.insertBefore(e.prev())}).on("click",".customfield-move-down",function(){var e=d(this).parent();e.insertAfter(e.next())}).on("change",".customfield-type",function(){var e=d(this).val();d(this).parent().parent().find(".customfield-additional").slideUp(200).find("input").prop("disabled",true);if(e!="textfield"){d(this).parent().parent().find(".customfield-"+e).stop().slideDown(200).find("input").prop("disabled",false)}}).on("change",".customfield-value",function(){d(this).next().find("input").val(d(this).val())}).on("click","a.customfield-value-remove",function(){d(this).parent().parent().remove()}).on("click","a.customfield-value-add",function(){var e=d(this).parent().find("li").eq(0).clone();e.appendTo(d(this).parent().find("ul")).find("input").val("").focus().select()});d("#mailster_import_data").on("click",function(){if(!confirm(c.l10n.settings.import_data))return false});d("#mailster_reset_data").on("click",function(){if(!confirm(c.l10n.settings.reset_data))return false});function u(t,i,s,n){var a=d(this),l=d(".bounce-ajax-loading").css({visibility:"visible"}),o=d(".bouncetest_status");c.util.ajax("bounce_test_check",{identifier:t,passes:i,formdata:s},function(e){o.html(e.data.msg);if(e.data.complete){l.css({visibility:"hidden"});n&&n()}else{setTimeout(function(){u(t,++i,s,n)},1e3)}},function(e,t,i){l.css({visibility:"hidden"});a.prop("disabled",false);o.html(t+" "+e.status+": "+i)})}function f(){var s=d(".spf-result").css({visibility:"visible"});c.util.ajax("spf_check",function(e){if(e.success){s.html(e.data.message).addClass(e.data.found?"verified":"not-verified").removeClass("spinner")}else{}},function(e,t,i){s.html("error")})}function p(){var s=d(".dkim-result").css({visibility:"visible"});c.util.ajax("dkim_check",function(e){if(e.success){s.html(e.data.message).addClass(e.data.found?"verified":"not-verified").removeClass("spinner")}else{}},function(e,t,i){s.html("error")})}function m(e){var t=c.util.sanitizeTag(e);if(d.inArray(t,o)!=-1){alert(c.util.sprintf(c.l10n.settings.reserved_tag,'"'+t+'"'));t+="-a"}return t}return c}(mailster||{},jQuery,window,document);