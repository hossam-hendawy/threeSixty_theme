mailster=function(l,o,t,e){"use strict";var a=o(".mailster-setup-step"),s,i,d=o(".status"),r=o(".spinner"),n=o("#step_start"),c=location.hash.substring(1),u=t.tinymce||false,f=false;if(c&&o("#step_"+c).length){n.removeClass("active");s=o("#step_"+c)}else{s=n}i=s.attr("id").replace(/^step_/,"");g(i);o("form.mailster-setup-step-form").on("submit",function(){o(".next-step:visible").hide();return false});o("#mailster-setup").on("click",".validation-skip-step",function(){return confirm(l.l10n.setup.skip_validation)}).on("click",".next-step",function(){if(o(this).hasClass("disabled"))return false;h()}).on("click",".load-language",function(){d.html(l.l10n.setup.load_language);r.css("visibility","visible");l.util.ajax("load_language",function(e){r.css("visibility","hidden");d.html(e.data.html);if(e.success){location.reload()}});return false}).on("click",".quick-install",function(){var e=o(this),a=e.closest("section"),t=a.data("name"),s=a.data("method"),i=a.data("plugin");if(e.hasClass("loading"))return false;e.addClass("loading");e.prop("disabled",true);y(s,i,"install",null,function(){o("section.current").removeClass("current");e.closest("section").addClass("current");o("#deliverymethod").val(s);o("#step_delivery").find(".next-step").html(sprintf(l.l10n.setup.use_deliverymethod,t));e.removeClass("loading");o("#step_delivery").find(".quick-install").removeClass("disabled");e.addClass("disabled");e.prop("disabled",false);h()})}).on("click",".save-delivery",function(){var a=o(this),e=a.closest("form"),t=e.serialize(),s=a.closest("section"),i=s.data("name"),n=s.data("method"),l=s.data("plugin");if(s.hasClass("loading"))return false;s.addClass("loading");a.addClass("loading");h(function(){y(n,l,"install",null,function(e){s.removeClass("loading");a.removeClass("loading")})})}).on("click",".send-test",function(){var i=o(this),n=i.closest("section"),e=o('input[name="mailster_options[from]"]').val(),a=i.closest("form").serialize();if(n.hasClass("loading"))return false;n.addClass("loading");i.addClass("loading");i.prop("disabled",true);l.util.ajax("send_test",{test:true,formdata:a,basic:true,to:e},function(e){if(e.data.log)e.success?l.log(e.data.log):l.log(e.data.log,"error");n.removeClass("loading");i.removeClass("loading");i.prop("disabled",false);var a=o("<span>"+e.data.msg+"</span>").hide().appendTo(n.find(".deliverystatus")).slideDown(200).delay(200).fadeIn().delay(4e3).fadeTo(200,0).delay(200).slideUp(200,function(){a.remove()})},function(e,a,t){n.removeClass("loading");i.removeClass("loading");i.prop("disabled",false);var s=o("<span>"+a+" "+e.status+": "+t+"</span>").hide().appendTo(n.find(".deliverystatus")).slideDown(200).delay(200).fadeIn().delay(4e3).fadeTo(200,0).delay(200).slideUp(200,function(){s.remove()})})}).on("click",".edit-slug",function(){o(this).parent().parent().find("span").hide().filter(".edit-slug-area").show().find("input").focus().select()}).on("click",".action-buttons a.edit-homepage",m).on("click",".template",function(){if(!o(this).hasClass("is-locked")){o(".template.active").removeClass("active");o(this).addClass("active");o("#default_template").val(o(this).data("slug"))}}).on("click",".upgrade-plan",function(){var a=o(this).data("plan");p(function(e){e.open({checkout_style:"next",plan_id:a,purchaseCompleted:function(e){console.log("purchaseCompleted",e);b(true)}})})});function p(i){if(t.FS){var e=FS.Checkout.configure(mailster_freemius);i&&i(e);return}o.getScript("https://checkout.freemius.com/checkout.min.js",function(e,a,t){var s=FS.Checkout.configure(mailster_freemius);i&&i(s)})}function m(){l.$.window.on("focus",v)}function v(){l.$.window.off("focus",v);l.$.window.off("blur",m);l.$.window.one("blur",m);o(".mailster-homepage-previews").find("iframe").each(function(){var e=o(this);var a=e.attr("src");e.attr("src",a)})}function h(a){var e=s.find("form").serialize();l.util.ajax("wizard_save",{id:i,data:e},function(e){e.success&&a&&a(e)})}l.$.window.on("hashchange",function(){var e=location.hash.substr(1)||"start",a=o(".mailster-setup-steps-nav").find("a[href='#"+e+"']");if(a.length){g(e);a.parent().parent().find("a").removeClass("next prev current");a.parent().prevAll().find("a").addClass("prev");a.addClass("current");if(u&&u.activeEditor)u.activeEditor.theme.resizeTo("100%",200)}switch(e){case"start":break;case"templates":if(!f){b();f=true}break;case"finish":h();break}});l.events.push("documentReady",function(){l.$.window.trigger("hashchange")});function g(e){var a=o("#step_"+e);if(a.length){s.removeClass("active");s=a;s.addClass("active");i=e;if(!l.util.inViewport(s.find("h2").get(0)))t.scrollTo({top:0,left:0,behavior:"smooth"})}}var C=false;function b(e){C=true;var s=o(".templates");s.addClass("loading");l.util.ajax("query_templates",{search:null,type:null,browse:"samples",page:1,reload_license:e},function(e){C=false;s.removeClass("loading");if(e.success){o(".templates").html(e.data.html)}},function(e,a,t){C=false;s.removeClass("loading")})}function y(a,t,e,s,i){d.html(l.l10n.setup.install_addon);r.css("visibility","visible");var n=o("#deliverytab-"+a);l.util.ajax("quick_install",{plugin:t,step:e,context:s},function(e){if(e.success){if(e.data.next){y(a,t,e.data.next,["deliverymethod_tab_"+a],i)}else if(e.data.content){n.html(e.data.content);d.html("");r.css("visibility","hidden");i&&i(e)}}else{}},function(e,a,t){})}return l}(mailster||{},jQuery,window,document);