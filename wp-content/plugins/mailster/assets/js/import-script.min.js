mailster=function(c,f,p,a){"use strict";var e,n=f(".uploadinfo"),i=f(".status"),m,r,u=false,h=false,g={},v=0,b=0,o={};c.$.document.on("submit",".importer-form",function(){var t=f(this);var e=t.serialize();var a=t.data("type");i=t.find(".status");t.prop("readonly",true).addClass("loading");i.addClass("progress spinner").html(c.l10n.manage.prepare_import);c.util.ajax("import_handler",{type:a,data:e},function(e){if(e.success){if(e.data.html){t.html(e.data.html)}if(e.data.identifier){r=e.data.identifier;s()}}else{i.html(e.data.msg).removeClass("spinner")}t.prop("readonly",false).css("opacity",1).removeClass("loading")},function(){t.prop("readonly",false).css("opacity",1).removeClass("loading")});return false}).on("submit",".importer-quickinstall-form",function(){var e=f(this);var t=e.serialize();var a=e.data("slug");var n=e.data("id");e.prop("readonly",true).addClass("loading");l(n,a,"install");return false}).on("change",".column-selector",function(){if("_new"==f(this).val()){var e=prompt(c.l10n.manage.define_custom_field,f(this).data("for")||c.l10n.manage.my_custom_field);if(!e)return false;var t=d(e);f(this).val(t)}}).on("click","#addlist",function(){var e=f("#new_list_name").val();if(!e){return false}f(c.util.sprintf('<li><label><input name="_lists[]" value="%s" type="checkbox" checked> %s </label></li>',e,e)).appendTo("#section-lists > ul");f("#new_list_name").val("");return false}).on("change","#signup",function(){f("#signupdate").prop("disabled",!f(this).is(":checked"))}).on("change",".wordpress-user-roles .list-toggle",function(){f(".no-role-cb").prop("checked",false)}).on("change","ul.roles input",function(){f(".no-role-cb").prop("checked",false)}).on("change",".no-role-cb",function(){f(this).parent().parent().parent().parent().find("ul.roles input").add(".wordpress-user-roles .list-toggle").prop("checked",false)}).on("click",".do-import",function(){var e=f("#subscriber-table").serialize();if(!/%5D=email/.test(e)){alert(c.l10n.manage.select_emailcolumn);return false}if(!f('input[name="status"]:checked').length){alert(c.l10n.manage.select_status);return false}if(!confirm(c.l10n.manage.confirm_import))return false;var t=f(this).prop("disabled",true),a=f('input[name="status"]:checked').val(),n=f("#import-ajax-loading").css({display:"inline-block"}),i=f("#identifier").val(),r=f("#performance").is(":checked");m=new Date;f(".import-process-wrap").show();g={identifier:i,data:e,status:a,performance:r,customfields:o};_();f(this).prop("disabled",false);p.onbeforeunload=function(){return c.l10n.manage.onbeforeunloadimport};return false}).on("click",".pause-import",function(){f(".import-process").addClass("paused");u=true;return false}).on("click",".resume-import",function(){f(".import-process").removeClass("paused");u=false;_();return false}).on("click",".cancel-import",function(){if(!confirm(c.l10n.manage.cancel_import))return false;h=true;if(u){u=false;_()}return false});typeof wpUploaderInit=="object"&&c.events.push("documentReady",function(){e=new plupload.Uploader(wpUploaderInit);e.bind("Init",function(e){var t=f("#plupload-upload-ui");if(e.features.dragdrop&&!f(a.body).hasClass("mobile")){t.addClass("drag-drop");f("#drag-drop-area").bind("dragover.wp-uploader",function(){t.addClass("drag-over")}).bind("dragleave.wp-uploader, drop.wp-uploader",function(){t.removeClass("drag-over")})}else{t.removeClass("drag-drop");f("#drag-drop-area").unbind(".wp-uploader")}if(e.runtime=="html4"){f(".upload-flash-bypass").hide()}});e.bind("FilesAdded",function(e,t){f("#media-upload-error").html("");f("#wordpress-users").fadeOut();setTimeout(function(){e.refresh();e.start()},1)});e.bind("BeforeUpload",function(e,t){n.html("uploading")});e.bind("UploadFile",function(e,t){});e.bind("UploadProgress",function(e,t){n.html(c.util.sprintf(c.l10n.manage.uploading,t.percent+"%"))});e.bind("Error",function(e,t){n.html(t.message);e.refresh()});e.bind("FileUploaded",function(e,t,a){a=JSON.parse(a.response);if(a.success){r=a.data.identifier}else{n.html(a.data.message);e.refresh()}});e.bind("UploadComplete",function(e,t){if(r){n.html(c.l10n.manage.prepare_data);s()}});e.init()});function _(){var t=b,a,n,i,r,o,s=f(".import-process").find(".bar"),l=f(".import-percentage"),d=(new Date).getTime();if(u){return false}if(!v){k(0,0,0,0,0);s.width(0)}c.util.ajax("do_import",{id:v,options:g,canceled:h},function(e){if(e.success){t=e.data.p_total*100;o=e.data.p_total>=1||e.data.canceled;a=t-b;n=b;b=t;k(e.data.f_imported,e.data.f_errors,e.data.f_total,t,e.data.memoryusage);s.stop(true,true).animate({width:t+"%"},{duration:(new Date).getTime()-d,easing:"linear",progress:function(e,t){i=Math.floor(n+a*t);if(i!=r){l.html(i+"%");r=i}},complete:function(){if(o){p.onbeforeunload=null;f(".import-result").html(e.data.html);y();f(".import-process-wrap").hide()}}});if(!o){++v;_()}}else{w(e.data.msg)}},function(e,t,a){w(t)})}function w(e){i.removeClass("progress spinner").html(e)}function y(e){p.scroll({top:e||125,left:0,behavior:"smooth"})}function s(){c.util.ajax("get_import_data",{identifier:r},function(e){if(e.success){y();f(".import-result").eq(0).html(e.data.html).show();f(".import-wrap").hide();f.fn.select2&&f(".tags-input").select2({placeholder:c.l10n.manage.choose_tags,tags:true,theme:"mailster"});i=f(".import-process").find(".import-status")}})}function k(e,t,a,n,i){var r=(new Date).getTime()-m.getTime(),o=Math.ceil((100-n)*(r/n)/1e3);var s=new Date(o*1e3),l=s.getHours()-1,d=s.getMinutes(),p=s.getSeconds(),u=(o>=3600?(l<10?"0"+l:l)+":":"")+((d<10?"0"+d:d)+":")+(p<10?"0"+p:p);e&&f(".import-imported").html(c.util.sprintf(c.l10n.manage.import_imported,e,a));t&&f(".import-errors").html(c.util.sprintf(c.l10n.manage.import_errors,t));e&&f(".import-memory").html(i);e&&f(".import-time").html(u)}function l(t,a,e,n){var i=f("#manage-import-"+t).find(".manage-import-body");c.util.ajax("quick_install",{plugin:a,step:e,context:n},function(e){if(e.success){if(e.data.next){l(t,a,e.data.next,["import_method",t])}else if(e.data.content){i.html(e.data.content)}}else{}},function(e,t,a){})}function d(e){var t=c.util.sanitizeTag(e);f("#subscriber-table").find(".custom-fields-select").each(function(){f('<option value="'+t+'">'+e+"</option>").appendTo(f(this))});o[t]=e;return t}return c}(mailster||{},jQuery,window,document);