mailster=function(i,d,e,t){"use strict";var a={},c,r=d(".mailster-precheck"),s=d(".precheck-status"),n=d(".precheck-score"),l=d("#precheck-ajax-loading"),M=d("#precheck-authentication"),o=d(".precheck-run-btn"),h=d(".precheck-toggle-structure"),u=d(".precheck-toggle-images"),p=d(".mailster-preview-iframe"),f,m,g,k=true,v=false;i.precheck=i.precheck||{};r.on("click",".precheck-switch",C).on("click",".precheck-run-btn",x).on("click",".precheck-toggle-images",B).on("click",".precheck-toggle-structure",z).on("mouseenter",".assets-table tr",L).on("mouseleave",".assets-table tr",L).on("click",".change-receiver",A).on("click","#precheck-agree",D);d(".precheck-subscriber").on("focus",function(){d(this).select()}).autocomplete({source:function(e,t){i.util.ajax("search_subscribers",{id:i.campaign_id,term:e.term},function(e){t(e)},function(e,t,a){})},appendTo:".precheck-emailheader",minLength:3,select:function(e,t){d("#subscriber_id").val(t.item.id);I()},change:function(e,t){if(!t.item){d("#subscriber_id").val(0);I()}}});function b(e,t){var a=i.l10n.precheck[e]||e;n.removeAttr("class").addClass("precheck-score precheck-status-"+e);if(t){s.html(s.html()+a)}else{s.html(a)}}function _(e){var t=d('<div class="error"><p><strong>'+e+"</strong></p></div>").hide().appendTo(d(".score-message")).slideDown(200).delay(200).fadeIn().delay(8e3).fadeTo(200,0).delay(1500).slideUp(200,function(){t.remove()});i.error(e)}function w(e){l.css("visibility",e?"visible":"hidden")}function C(){var e=d(this).data("dimensions");d(".device.desktop").width(e.w).height(e.h);d(".precheck-resize").find(".button").removeClass("active");d(this).addClass("active")}function x(){y();w(true);b("sending");o.prop("disabled",true);d(".precheck-status-icon").html("");i.util.ajax("send_test",{precheck:true,subscriber_id:d("#subscriber_id").val(),formdata:d("#post").serialize(),to:d("#mailster_testmail").val(),content:i.$.content.val(),head:i.$.head.val(),plaintext:i.$.excerpt.val()},function(e){if(e.success){c=e.data.id;setTimeout(function(){b("checking");j(1)},3e3)}else{_(e.data.msg);w(false);o.prop("disabled",false)}},function(e,t,a){w(false);o.prop("disabled",false)})}function y(){r.find("summary").removeAttr("class");r.find(".precheck-result").empty();b("ready")}function j(t){if(t>10){_(i.l10n.precheck.email_not_sent);w(false);o.prop("disabled",false);return}i.util.ajax("precheck",{id:c},function(e){if(e.success){if(!e.data.ready){setTimeout(function(){j(++t)},3e3)}else{b("collecting");d(".precheck-status-icon").html(i.util.sprintf("%s of 100",100));d.when.apply(d,[$("blocklist"),$("spam_report"),$("authentication"),$("message"),$("links","tests/links"),$("images","tests/images")]).done(function(e){b("finished");w(false);o.prop("disabled",false)})}}if(e.data.error){_(e.data.error);w(false);o.prop("disabled",false)}},function(e,t,a){w(false);o.prop("disabled",false)})}function $(a,e){var t=d("#precheck-"+a),r=t.find("details"),s,i=[];if(r.length){t.find("summary").eq(0).removeAttr("class").addClass("loading");for(var c=0;c<r.length;c++){s=r[c].id.replace("precheck-","");if(s){e="tests/"+s;i.push(T(s,e))}}}else{if(!e)e=a;i.push(T(a,e))}return d.when.apply(d,i).done(function(){var e,t={error:0,warning:0,notice:0,success:0};if(typeof arguments[1]!="string"){for(c in arguments){arguments[c]&&t[arguments[c][0].status]++}if(t.error){e="error"}else if(t.warning){e="warning"}else if(t.notice){e="notice"}else{e="success"}d("#precheck-"+a).find("summary").eq(0).removeClass("loading").addClass("loaded is-"+e)}})}function T(e,t){var a=d("#precheck-"+e),r=a.find("summary").eq(0).removeAttr("class").addClass("loading"),s=a.find(".precheck-result");return i.util.ajax("precheck_result",{id:c,endpoint:t},function(e){if(e.success){r.removeClass("loading").addClass("loaded is-"+e.data.status);if("error"==e.data.status){}d(".precheck-status-icon").html(i.util.sprintf("%s of 100",e.data.points));s.html(e.data.html)}if(e.data.error){_(e.data.error);w(false);o.prop("disabled",false)}},function(e,t,a){w(false);o.prop("disabled",false)})}function A(){d(".precheck-to").hide();d(".change-receiver").hide();d(".precheck-to-input").show().find("input").focus().select()}function q(){f=p.contents().find("html,body");m=f.find("highlighterx");g=f.find("highlightery");k=true;i.trigger("enable")}function I(t){if(!i.editor||!i.editor.loaded){i.events.push("editorLoaded",function(){I(t)});return}var e={id:i.campaign_id,subscriber_id:d("#subscriber_id").val(),content:i.editor.getContent(),head:i.$.head.val(),issue:d("#mailster_autoresponder_issue").val(),subject:i.details.$.subject.val(),preheader:i.details.$.preheader.val()},a=i.$.title.val();y();d(".precheck-status-icon").html("");i.util.ajax("set_preview",e,function(e){p.one("load",q).attr("src",ajaxurl+"?action=mailster_get_preview&hash="+e.data.hash+"&_wpnonce="+e.data.nonce);u.addClass("active");h.removeClass("active");i.util.tb_show(a?i.util.sprintf(i.l10n.campaigns.precheck,'"'+a+'"'):i.l10n.campaigns.preview,"#TB_inline?hash="+e.data.hash+"&_wpnonce="+e.data.nonce+"&width="+Math.min(1440,i.$.window.width()-50)+"&height="+(i.$.window.height()-100)+"&inlineId=mailster_precheck_wrap",null);d(".precheck-subject").html(e.data.subject);d(".precheck-subscriber").val(e.data.to);d(".precheck-to").text(e.data.to);t&&t()},function(e,t,a){i.trigger("enable")})}function z(){if(v){f.removeClass("precheck-structure-enabled")}else{f.addClass("precheck-structure-enabled")}h.toggleClass("active");v=!v}function B(){var e=f.find("img");if(!k){f.removeClass("precheck-images-hidden");d.each(e,function(e,t){d(t).attr("src",d(t).attr("data-src")).removeAttr("data-src")})}else{f.addClass("precheck-images-hidden");d.each(e,function(e,t){d(t).attr("data-src",d(t).attr("src")).attr("src","")})}u.toggleClass("active");k=!k}function L(e){var t=d(this),a=t.data(),r,s=e.type;if(!a.el){var i=a.url,c=a.tag,n=a.attr,l=a.index,r=p.contents().find(c+"["+n+'="'+i+'"]')[l];t.data("el",r)}else{r=a.el}if(!r){return}if("mouseleave"==s){f.removeClass("precheck-highlighter");d(r).removeClass("precheck-highlighted");return}else{d(r).addClass("precheck-highlighted");f.addClass("precheck-highlighter")}r.scrollIntoView({behavior:"smooth",block:"center"});var o=r.getBoundingClientRect();m.css({transform:"translate("+o.x+"px, "+(o.y+f.scrollTop())+"px)",width:o.width,height:o.height});g.css({transform:"translate("+o.x+"px, "+(o.y+f.scrollTop())+"px)",width:o.width,height:o.height})}function D(){if(!d("#precheck-agree-checkbox").is(":checked")){alert(i.l10n.campaigns.agree_precheck_terms);return false}i.util.ajax("precheck_agree",function(e){r.addClass("precheck-terms-agreed");i.precheck.terms_accepted=true})}i.precheck.open=function(e){i.trigger("save");i.trigger("disable");d(".precheck-from").html(d("#mailster_from-name").val());I(e)};i.precheck.start=x;i.precheck.terms_accepted=!!d(".precheck-terms-agreed").length;return i}(mailster||{},jQuery,window,document);