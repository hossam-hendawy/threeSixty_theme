mailster=function(b,k,x,_){"use strict";var e=k(".wp-filter"),a=k(".theme-browser"),n=e.find(".filter-links a"),t=e.find(".search-form"),s=e.find(".wp-filter-search"),i=e.find("#typeselector"),l,d,o="",r="",c=1,u=0,f=0,m=s.val(),g=i.val(),h=[],j=false,F=false;n.on("click",function(e){e.preventDefault();if(!j)D(k(this).data("sort"));return});t.on("submit",function(e){e.preventDefault();l&&clearTimeout(l);T()});s.on("keyup change",function(e){if(13==e.keyCode){return}l&&clearTimeout(l);l=setTimeout(T,1e3)});i.on("change",function(e){l&&clearTimeout(l);T()});a.on("click",".theme-screenshot, .more-details",function(){p.open(k(this).closest(".theme"))}).on("click",".update",function(e){e.preventDefault();k(this).addClass("updating-message");A(this.href,k(this).closest(".theme").data("slug"))}).on("click",".download",function(e){e.preventDefault();k(this).addClass("updating-message");$(this.href,k(this).closest(".theme").data("slug"))}).on("click",".install",function(e){e.preventDefault();k(this).addClass("updating-message");q(k(this).closest(".theme").data("slug"))}).on("click",".activate",function(e){e.preventDefault();k(this).addClass("updating-message");R(k(this).closest(".theme").data("slug"))}).on("click",".deactivate",function(e){e.preventDefault();k(this).addClass("updating-message");z(k(this).closest(".theme").data("slug"))}).on("click",".popup",function(){var e=this.href;if(!/^https?/.test(e))return true;var t=k(this).data(),a=x.screenLeft!=undefined?x.screenLeft:screen.left,n=x.screenTop!=undefined?x.screenTop:screen.top,s=b.$.window.width(),i=b.$.window.height(),l,d,o;if(/%/.test(t.width)){t.width=s*(parseInt(t.width,10)/100)}if(/%/.test(t.height)){t.height=i*(parseInt(t.height,10)/100)}l=s/2-t.width/2+a;d=i/2-t.height/2+n;o=x.open(e,"mailster_themebrowser","scrollbars=auto,resizable=1,menubar=0,toolbar=0,location=0,directories=0,status=0, width="+t.width+", height="+t.height+", top="+d+", left="+l);if(x.focus)o.focus();return false});k(".upload-addon").on("click",function(){k(".upload-field").toggle()});b.$.window.on("click",".upload-addon",function(){k(".upload-field").show()});b.events.push("documentReady",function(){b.$.window.on("scroll.mailster",b.util.throttle(C,500))});var p=function(){if(this===x)return new n;var n=k(".theme-overlay"),s=null,i=null,l=null,e=null,d=n.find(".right"),o=n.find(".left"),t=n.find(".close"),a=n.find(".default"),r=n.find(".campaign"),c=n.find(".delete-theme"),u={};var f=function(e){if("string"===typeof e){e=k('[data-slug="'+e+'"]')}if(!e||!e.length)return false;n.find(".theme-screenshots img").hide();n.find(".theme-screenshots iframe").hide();n.removeAttr("class");n.addClass("theme-overlay loading");s=e;u=e.data("item");n.find(".theme-name").html(u.name+'<span class="theme-version">'+(u.version?u.version:"")+"</span>");n.find(".theme-author").html(b.util.sprintf("By "+u.author));n.find(".theme-description").html(u.description);n.find(".theme-tags").html(u.tags&&u.tags.length?"<span>Tags:</span> "+u.tags.join(", "):"");if(u.src){n.find(".theme-screenshots iframe").show().attr("src",u.src+"?nocache="+ +new Date)}else{n.find(".theme-screenshots img").attr("src",u.image_full).attr("srcset",u.image_full+" 1x, "+u.image_fullx2+" 2x")}if(u.update_available)n.addClass("has-update");if(u.installed)n.addClass("is-installed");if(u.is_default)n.addClass("is-default");if(u.download)n.addClass("has-download");if(u.purchase_url)n.addClass("has-purchase");var t="";if(u.files){t+='<label>Template Files: <select class="theme-file-selector">';for(var a in u.files){if(u.files.hasOwnProperty(a))t+='<option value="'+a+'">'+u.files[a].label+" ("+a+")</option>"}t+="</select></label>"}n.find(".theme-files").html(t);i=s.prev();l=s.next();o.prop("disabled",!i.length)[!i.length?"addClass":"removeClass"]("disabled");d.prop("disabled",!l.length)[!l.length?"addClass":"removeClass"]("disabled");n.show();I("addon",u.slug);n.removeClass("loading")},m=function(){P("addon");n.hide()},g=function(){f(s.next())},h=function(){f(s.prev())},p=function(){var e=k(".theme-file-selector").val();if("index.html"==e&&confirm(b.util.sprintf(b.l10n.addons.confirm_delete,'"'+u.name+'"'))){U(u.slug);m()}else if(confirm(b.util.sprintf(b.l10n.addons.confirm_delete_file,'"'+e+'"','"'+u.name+'"'))){U(u.slug,e,function(){k(".theme-file-selector").val("index.html").trigger("change").find('option[value="'+e+'"]').remove()})}return false},v=function(){if(confirm(b.util.sprintf(b.l10n.addons.confirm_default,'"'+u.name+'"'))){var t=k('[data-slug="'+u.slug+'"]');j=true;b.util.ajax("default_addon",{slug:u.slug},function(e){if(e.success){D("installed",function(){k('[data-slug="'+u.slug+'"]').find(".notice-success").html("<p>"+e.data.msg+"</p>")});t.find(".notice-error").empty()}else{t.find(".notice-error").html("<p>"+e.data.msg+"</p>")}t.removeClass("loading").find(".updating-message").removeClass("updating-message");j=false;m()},function(e,t,a){})}return false},C=function(){_.location=this.href+"&addon="+u.slug+"&file="+n.find(".theme-file-selector").val();return false},w=function(){n.find(".theme-screenshots iframe").attr("src",u.files[k(this).val()].src)},y=function(){d.on("click",g);o.on("click",h);t.on("click",m);c.on("click",p);a.on("click",v);r.on("click",C);n.on("change",".theme-file-selector",w);n.find(".theme-screenshots iframe").on("load",function(){n.removeClass("loading")});n.find(".theme-screenshots img").on("load",function(){k(this).show()})};y();return{open:f,close:m,next:g,prev:h,delete:p}}();function v(){s.val(S("search"));i.val(S("type")||"term");d=S("browse")||"all";if(S("search")){T()}else{D(d);p.open(S("addon"))}}function C(){var e=b.util.top()+b.$.window.height();if(!j&&e>Math.round(_.documentElement.scrollHeight*.9)&&u>f){c++;L()}}function D(e,t){d&&k("body").removeClass("browse-"+d)&&n.filter('[data-sort="'+d+'"]').removeClass("current");d=e||false;P("addon");if(d){y();n.filter('[data-sort="'+d+'"]').addClass("current");I("browse",d);k("body").addClass("browse-"+d);L(t)}}function w(){d&&k("body").removeClass("browse-"+d)&&n.filter('[data-sort="'+d+'"]').removeClass("current");P("browse");P("addon");d=false;c=1;h=[]}function y(){P("search");P("type");r="";o="";s.val("");i.val("term");c=1;h=[]}function T(){m=b.util.trim(s.val());m=m.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");g=i.val();if(m&&(o!=m||r!=g)){r=g;o=m;w();L();I("search",m);I("type",g)}return}function q(e){var t=k('[data-slug="'+e+'"]');j=true;t.addClass("loading");t.find(".notice-warning").addClass("updating-message").html("<p>"+b.l10n.addons.installing+"</p>");b.util.ajax("quick_install",{plugin:e,step:"install"},function(e){if(e.success){t.addClass("is-installed").find(".notice-warning").removeClass("updating-message notice-warning").addClass("notice-success").html("<p>"+b.l10n.addons.installed+"</p>");t.find(".notice-error").empty()}else{t.find(".notice-error").html("<p>"+e.data.msg+"</p>")}t.removeClass("loading").find(".updating-message").removeClass("updating-message");j=false},function(e,t,a){})}function $(e,t){var a=k('[data-slug="'+t+'"]');console.log(a);j=true;a.addClass("loading").find(".request-download").addClass("updating-message");a.find(".notice-warning").addClass("updating-message").html("<p>"+b.l10n.addons.installing+"</p>");return;b.util.ajax("quick_install",{url:e,slug:t},function(e){if(e.success){a.addClass("is-installed").find(".notice-warning").removeClass("updating-message notice-warning").addClass("notice-success").html("<p>"+b.l10n.addons.installed+"</p>");a.find(".notice-error").empty()}else{a.find(".notice-error").html("<p>"+e.data.msg+"</p>")}a.removeClass("loading").find(".updating-message").removeClass("updating-message");j=false},function(e,t,a){})}function R(e){var t=k('[data-slug="'+e+'"]');j=true;t.addClass("loading");t.find(".notice-warning").addClass("updating-message").html("<p>"+b.l10n.addons.activating+"</p>");b.util.ajax("quick_install",{plugin:e,step:"activate"},function(e){if(e.success){t.addClass("active").find(".notice-warning").removeClass("updating-message notice-warning").addClass("notice-success").html("<p>"+b.l10n.addons.activated+"</p>");t.find(".notice-error").empty()}else{t.find(".notice-error").html("<p>"+e.data.msg+"</p>")}t.removeClass("loading").find(".updating-message").removeClass("updating-message");j=false},function(e,t,a){})}function z(e){var t=k('[data-slug="'+e+'"]');j=true;t.addClass("loading");t.find(".notice-warning").addClass("updating-message").html("<p>"+b.l10n.addons.deactivating+"</p>");b.util.ajax("quick_install",{plugin:e,step:"deactivate"},function(e){if(e.success){t.removeClass("active").find(".notice-warning").removeClass("updating-message notice-warning").addClass("notice-success").html("<p>"+b.l10n.addons.deactivated+"</p>");t.find(".notice-error").empty()}else{t.find(".notice-error").html("<p>"+e.data.msg+"</p>")}t.removeClass("loading").find(".updating-message").removeClass("updating-message");j=false},function(e,t,a){})}function A(e,t){var a=k('[data-slug="'+t+'"]');j=true;a.addClass("loading").find(".request-download").addClass("updating-message");a.find(".notice-warning").addClass("updating-message").html("<p>"+b.l10n.addons.updating+"</p>");b.util.ajax("download_addon",{url:e,slug:t},function(e){if(e.success){a.find(".notice-warning").removeClass("updating-message notice-warning").addClass("notice-success").html("<p>"+b.l10n.addons.updated+"</p>");a.find(".notice-error").empty();var t=k("#menu-posts-newsletter").find(".current").find(".update-plugins");if(t){if(t.text()>1){t.find(".update-count").text(t.text()-1)}else{t.remove()}}}else{a.find(".notice-error").html("<p>"+e.data.msg+"</p>")}a.removeClass("loading").find(".updating-message").removeClass("updating-message");j=false},function(e,t,a){})}function U(e,t,a){var n=k('[data-slug="'+e+'"]');j=true;n.addClass("loading");b.util.ajax("delete_addon",{slug:e,file:t||null},function(e){if(a){n.removeClass("loading");a()}else{n.animate({opacity:0},function(){n.animate({width:0,"margin-right":0},function(){n.remove();j=false})})}},function(e,t,a){})}function B(e,t){var a=k('[data-slug="'+e+'"]');a.find(".notice-error").html("<p>"+k("<div>"+t+"</div>").text()+"</p>")}function L(t){if(c==1){k("body").removeClass("no-results");k("body").addClass("loading-content");a.html("");h=[]}j=true;b.util.ajax("query_addons",{search:s.val(),type:i.val(),browse:S("browse"),page:c},function(e){if(c==1){k("body").removeClass("loading-content");k(".theme-count").html(e.data.total);u=e.data.total}h.concat(e.data.addons);a.append(e.data.html);f=k(".theme").length;if(e.data.error){alert(e.data.error);k("body").addClass("no-results")}else if(!f){k("body").addClass("no-results")}j=false;t&&t()},function(e,t,a){})}function S(e){var t=new URLSearchParams(x.location.search);return t.get(e)}function I(e,t){var a=new URLSearchParams(x.location.search);a.set(e,t);x.history.pushState({},"",decodeURIComponent(x.location.pathname+"?"+a))}function P(e){var t=new URLSearchParams(x.location.search);t.delete(e);x.history.pushState({},"",decodeURIComponent(x.location.pathname+"?"+t))}v();b.addons=b.addons||{};b.addons.install=q;b.addons.installFromUrl=$;b.addons.delete=U;b.addons.error=B;return b}(mailster||{},jQuery,window,document);