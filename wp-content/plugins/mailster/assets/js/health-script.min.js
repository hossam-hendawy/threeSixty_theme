mailster=function(r,o,e,s){"use strict";var t=o("#mailster-health"),n=t.find(".button-primary"),l;t.on("submit",".health_form",i);function c(e){}function a(e){r.warning(e)}function i(){c(true);a("sending");n.prop("disabled",true);o(".precheck-results").slideDown();o(".precheck-result").html("");o(".precheck-status-icon").html("");o("summary").addClass("loading").removeClass("is-error is-warning is-notice is-success");r.util.ajax("health_check",function(e){if(e.success){l=e.data.id;setTimeout(function(){a("checking");f(1)},3e3)}else{d(e.data.msg);c(false);n.prop("disabled",false)}},function(e,s,t){c(false);n.prop("disabled",false)});return false}function d(e){var s=o('<div class="error"><p><strong>'+e+"</strong></p></div>").hide().appendTo(o(".error-msg")).slideDown(200).delay(200).fadeIn().delay(8e3).fadeTo(200,0).delay(1500).slideUp(200,function(){s.remove()});r.error(e)}function f(s){if(s>10){d("email not sent");c(false);n.prop("disabled",false);return}r.util.ajax("precheck",{id:l},function(e){if(e.success){if(!e.data.ready){setTimeout(function(){f(++s)},3e3)}else{a("collecting");o(".precheck-status-icon").html(r.util.sprintf("%s of 100",100));o.when.apply(o,[u("blocklist"),u("authentication","tests/spf"),u("authentication","tests/dkim"),u("authentication","tests/dmarc"),u("authentication","tests/rdns"),u("authentication","tests/mx"),u("authentication","tests/a")]).done(function(e){a("finished");c(false);n.prop("disabled",false);o(".get-help").show()})}}if(e.data.error){d(e.data.error);c(false);n.prop("disabled",false)}},function(e,s,t){c(false);n.prop("disabled",false)})}function u(t,e){var s=o("#precheck-"+t),a=s.find("details"),i,r=[];if(a.length){s.find("summary").eq(0).removeAttr("class").addClass("loading");for(var n=0;n<a.length;n++){i=a[n].id.replace("precheck-","");if(i){e="tests/"+i;r.push(p(i,e))}}}else{if(!e)e=t;r.push(p(t,e))}return o.when.apply(o,r).done(function(){var e,s={error:0,warning:0,notice:0,success:0};if(typeof arguments[1]!="string"){for(n in arguments){arguments[n]&&s[arguments[n][0].status]++}if(s.error){e="error"}else if(s.warning){e="warning"}else if(s.notice){e="notice"}else{e="success"}o("#precheck-"+t).find("summary").eq(0).removeClass("loading").addClass("loaded is-"+e)}})}function p(e,s){var t=o("#precheck-"+e),a=t.find("summary").eq(0).removeAttr("class").addClass("loading"),i=t.find(".precheck-result");return r.util.ajax("precheck_result",{id:l,endpoint:s},function(e){if(e.success){a.removeClass("loading").addClass("loaded is-"+e.data.status);if("error"==e.data.status){}o(".precheck-status-icon").html(r.util.sprintf("%s of 100",e.data.points));i.html(e.data.html)}if(e.data.error){d(e.data.error);c(false);n.prop("disabled",false)}},function(e,s,t){c(false);n.prop("disabled",false)})}return r}(mailster||{},jQuery,window,document);