mailster=function(r,o,a,e){"use strict";if(typeof mailster_updates=="undefined"){return}var s=o("#output"),t=o("#error-list"),n=[],i,u,p=o('<span>&nbsp;</span><a class="skipbutton button button-small" href title="skip this step">skip</a>'),l=false,f=mailster_updates_performance[0]||1,d=o.map(mailster_updates,function(e,t){return t});s.on("click",".skipbutton",function(){l=true;return false});r.$.document.ajaxError(function(){t.append("Script paused...continues in 5 seconds...<br>");setTimeout(function(){t.empty();c(u,true)},5e3)});if(mailster_updates_options.autostart){o("#mailster-update-process").show();c(0)}else{o("#mailster-update-info").show();o("#mailster-start-upgrade").one("click",function(){o("#mailster-update-process").show();o("#mailster-update-info").hide();c(0)})}function c(e,t){if(!e){a.onbeforeunload=function(){return"You have to finish the update before you can use Mailster!"}}var n=d[e];u=e;if(!(i=mailster_updates[n])){v();return}if(!t)b(n,"<span>"+i+"</span> ...",true,0);h(n,function(){setTimeout(function(){c(++e)},1e3)},function(){m()},1)}function h(t,n,a,i){r.util.ajax("batch_update",{id:t,performance:f},function(e){if(e.data.output)_(e.data.output);if(e.success){if(l){b(t," &times;",false);l=false;n&&n()}else if(e.data[t]){b(t," &#10004;",false);n&&n()}else{b(t,".",false,i);setTimeout(function(){h(t,n,a,++i)},5)}}else{a&&a()}},function(e,t,n){_(e.responseText);alert("There was an error while doing the update! Please check the textarea on the right for more info!");m()})}function m(){a.onbeforeunload=null;b("error","Error ",true)}function v(){a.onbeforeunload=null;b("finished","<h3>Alright, all updates have been finished!</h3>",true,0,true);var e=a.location.search;var t=new URLSearchParams(e);var n=t.get("redirect_to")?t.get("redirect_to"):"admin.php?page=mailster_dashboard";b("finished_button",'<a href="'+n+'" class="button button-primary button-hero">Ok, fine!</a>',true,0,true);o("#mailster-post-upgrade").show()}function b(e,t,n,a,i){if(!o("#output_"+e).length){o('<div class="'+(i?"":"notice notice-info inline active "+e)+'" style="padding: 0.5em 6px;word-wrap: break-word;"><div id="output_'+e+'"></div></div>').appendTo(s)}var r=o("#output_"+e);r.append(t);if(typeof a==="undefined"){r.parent().removeClass("active")}a>50?r.append(p.show()):p.hide()}function _(e){var t=o("#textoutput");var n=t.val();e=n+e;t.val(r.util.trim(e)+"\n\n");t.scrollTop(t[0].scrollHeight)}return r}(mailster||{},jQuery,window,document);