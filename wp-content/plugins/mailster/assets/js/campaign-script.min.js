mailster=function(e,t,i,a){"use strict";e.$=e.$||{};e.$.body=t("body");e.$.wpbody=t("#wpbody");e.$.form=t("#post");e.$.title=t("#title");e.$.iframe=t("#mailster_iframe");e.$.templateWrap=t("#template-wrap");e.$.template=t("#mailster_template");e.$.datafields=t('[name^="mailster_data"]');e.$.content=t("#content");e.$.excerpt=t("#excerpt");e.$.plaintext=t("#plain-text-wrap");e.$.html=t("#html-wrap");e.$.head=t("#head");e.$.optionbar=t("#optionbar");e.$.editbar=t("#editbar");e.campaign_id=parseInt(t("#post_ID").val(),10);e.user_id=parseInt(t("#user-id").val(),10);e.enabled=false;e.editable=!t("#mailster_disabled").val();return e}(mailster||{},jQuery,window,document);mailster=function(a,e,t,i){"use strict";a.events.push("documentReady",function(){if(!a.editable){a.$.iframe.on("load",function(){a.trigger("iframeLoaded")})}a.$.iframe.attr("src",a.$.iframe.data("src"))});a.events.push("editorLoaded",function(){a.$.iframe.removeClass("loading")});a.events.push("iframeLoaded",function(){a.$.iframe.removeClass("loading");a.$.iframecontents=a.$.iframe.contents()});a.events.push("disable",function(){a.enabled=false});a.events.push("enable",function(){a.enabled=true});a.events.push("redraw",function(){a.trigger("refresh")});a.events.push("resize",function(){e("#editor-height").val(a.editor.getHeight())});a.events.push("save",function(){if(!a.editor||!a.editor.loaded)return;var e=a.editor.getFrameContent(),t=a.optionbar.undos.length,i=a.optionbar.undos[t-1];if(i!=e){a.$.content.val(e);a.details.$.preheader.prop("readonly",!e.match("{preheader}"));a.optionbar.undos=a.optionbar.undos.splice(0,a.optionbar.currentUndo+1);a.optionbar.undos.push(e);if(t>=a.l10n.campaigns.undosteps)a.optionbar.undos.shift();a.optionbar.currentUndo=a.optionbar.undos.length-1;if(a.optionbar.currentUndo)a.$.optionbar.find("a.undo").removeClass("disabled");a.$.optionbar.find("a.redo").addClass("disabled");if(wp&&wp.autosave)wp.autosave.local.save()}});return a}(mailster||{},jQuery,window,document);mailster=function(a,n,e,t){"use strict";var i;if(a.util.isMSIE)a.$.body.addClass("ie");if(a.util.isTouchDevice)a.$.body.addClass("touch");a.$.window.on("resize.mailster",s);a.$.document.on("change","input[name=screen_columns]",function(){a.$.window.trigger("resize")}).on("click",".restore-backup",function(e,t){var t=wp.autosave.local.getSavedPostData();a.editor.setContent(t.content);a.$.title.val(t.post_title);return false}).on("submit","form#post",function(){if(!a.enabled)return false;a.trigger("save")}).on("change",".dynamic_embed_options_taxonomy",function(){var e=n(this),t=e.val(),i=e.parent();i.find(".button").remove();if(t!=-1){if(i.find("select").length<e.find("option").length-1)n(' <a class="button button-small add_embed_options_taxonomy">'+a.l10n.campaigns.add+"</a>").appendTo(e.closest(".dynamic_embed_options_taxonomy_wrap"))}else{i.find("select").select2("destroy");i.html("").append(e);e.select2()}return false}).on("click",".add_embed_options_taxonomy",function(){var e=n(this),t=e.prev().prev(),i;t.select2("destroy");i=t.clone();t.select2();i.insertBefore(e).val("-1");n("<span> "+a.l10n.campaigns.or+" </span>").insertBefore(i);i.select2();e.remove();return false});!a.editable&&a.events.push("documentReady",function(){a.$.window.off("beforeunload.edit-post")});function s(){clearTimeout(i);i=setTimeout(function(){a.trigger("refresh")},250)}return a}(mailster||{},jQuery,window,document);mailster=function(e,s,t,n){"use strict";e.util=e.util||{};e.util.isTinyMCE=null;e.events.push("documentReady",function(){e.util.isTinyMCE=typeof tinymce=="object"});e.util.getRealDimensions=function(e,t){e=e.eq(0);if(e.is("img")&&e.attr("src")){var i=new Image,a;i.onload=function(){a=(i.width/e.width()).toFixed(1)||1;if(t)t.call(this,i.width,i.height,isFinite(a)?parseFloat(a):1)};i.src=e.attr("src")}};e.util.tempMsg=function(e,t,i,a){var n=s('<div class="'+t+'"><p>'+e+"</p></div>").hide().prependTo(i).slideDown(200).delay(200).fadeIn().delay(3e3).fadeTo(200,0).delay(200).slideUp(200,function(){n.remove();a&&a()});return n};e.util.selectRange=function(e,t,i){if(n.selection&&n.selection.createRange){e.focus();e.select();var a=n.selection.createRange();a.collapse(true);a.moveEnd("character",i);a.moveStart("character",t);a.select()}else{e.selectionStart=t;e.selectionEnd=i}return true};e.util.replace=function(e,t,i){if(t===i)return e;do{e=e.replace(t,i)}while(t&&e.indexOf(t)!==-1);return e};return e}(mailster||{},jQuery,window,document);mailster=function(e,a,n,t){"use strict";e.thickbox=e.thickbox||{};e.thickbox.$={};e.thickbox.$.preview=a(".mailster-preview-iframe");e.thickbox.$.preview.on("load",function(){var e=a(this),t=e.contents(),i=t.find("body");i.on("click","a",function(){var e=a(this).attr("href");if(e&&e!="#")n.open(e);return false})});return e}(mailster||{},jQuery,window,document);mailster=function(l,c,e,t){"use strict";var i=c("#mailster_template"),a=c("#module-selector"),n=c("#module-search"),s=a.find("li"),o=c("a.toggle-modules");l.modules=l.modules||{};l.modules.showSelector=l.user.get("showmodules",true);l.modules.dragging=false;l.modules.selected=false;function r(e){for(var t in l.editor.colors.map){e=l.util.replace(e,t,l.editor.colors.map[t])}return e}function d(){var e=a.data("current"),t=c(this).parent().find("script").html(),i=c(this).parent().data("id");v(r(t),e&&e.is("module")?e:false,true,true,i)}function u(){var t=c(this).parent(),e=t.find("span").eq(0).text(),i=t.data("id"),a=l.util.sprintf(l.l10n.campaigns.delete_module,'"'+e+'"');if(confirm(a)){l.util.ajax("delete_module",{id:i,template:c("#mailster_template_name").val(),file:c("#new_template_saveas_dropdown").val()},function(e){if(e.success){t.fadeTo(25,0,function(){t.slideUp(100,function(){t.remove()})})}else{alert(e.data.msg)}},function(e,t,i){})}}function f(){var e=c(this).parent().parent().parent().addClass("ui-sortable-fly-over"),t=e.prev("module").addClass("ui-sortable-fly-under"),i=l.util.top()-t.height();e.css({transform:"translateY(-"+t.height()+"px)"});t.css({transform:"translateY("+e.height()+"px)"});l.util.scroll(i,function(){e.insertBefore(t.css({transform:""}).removeClass("ui-sortable-fly-under")).css({transform:""}).removeClass("ui-sortable-fly-over");l.trigger("refresh");l.trigger("save")},250)}function p(){var e=c(this).parent().parent().parent().addClass("ui-sortable-fly-over"),t=e.next("module").addClass("ui-sortable-fly-under"),i=l.util.top()+t.height();e.css({transform:"translateY("+t.height()+"px)"});t.css({transform:"translateY(-"+e.height()+"px)"});l.util.scroll(i,function(){e.insertAfter(t.css({transform:""}).removeClass("ui-sortable-fly-under")).css({transform:""}).removeClass("ui-sortable-fly-over");l.trigger("refresh");l.trigger("save")},250)}function m(){var e=c(this).parent().parent().parent(),t=e.clone().removeAttr("selected").hide();v(t,e,false,true)}function h(){var e=c(this).parent().parent().parent();l.editbar.open({element:e,name:e.attr("label"),type:"auto",offset:e.offset()})}function g(){var e=c(this).parent().parent().parent();e.fadeTo(25,0,function(){e.slideUp(100,function(){e.remove();l.trigger("refresh");if(!l.editor.$.modules.length)l.editor.$.container.html("");l.trigger("save")})})}function v(e,t,i,a,n){var s;if(typeof e=="string"){s=c(e)}else if(e instanceof jQuery){s=c(e);s.find("single, multi, buttons").removeAttr("contenteditable spellcheck id dir style class")}else{return false}if(!t&&!l.editor.$.container.length)return false;if(n){s.attr("data-module",n)}if(t){i?s.hide().insertBefore(t):s.hide().insertAfter(t)}else{var o=l.editor.$.modules.filter("[type=footer]");if(o.length>0){s.hide().insertBefore(o.first())}else{s.hide().appendTo(l.editor.$.container)}}l.editor.updateElements();l.editor.moduleButtons();s.slideDown(100,function(){s.css("display","block");l.trigger("refresh");l.trigger("save")});if(a){var r=s.offset().top+l.$.template.offset().top-l.$.window.height()/2;l.util.scroll(r)}}function _(){var e=c(this).parent().parent().parent();l.editbar.open({element:e,name:e.attr("label"),type:"codeview",offset:e.offset()})}function b(){var e=c(this).parent().parent().parent(),t=e.attr("label"),i=e[0].hasAttribute("auto"),a=l.editor.cleanHTML(e.html());l.util.tb_show(l.l10n.campaigns.save_module,"#TB_inline?x=1&width=480&height=220&inlineId=module-save-dialog",null);c("#new_module_name").val(t).focus().select();c("#new_module_content").val(a);c("#new_module_type").val(i)}function w(){l.$.templateWrap.toggleClass("show-modules");l.modules.showSelector=!l.modules.showSelector;l.user.set("showmodules",l.modules.showSelector);setTimeout(function(){l.trigger("resize")},200)}function k(){s.hide();a.find("li:contains('"+c(this).val()+"')").show()}function y(){l.trigger("disable");var e=c("#new_module_name").val();if(!e){return false}var a=c("#new_module-ajax-loading").css("visibility","visible"),t=c("#new_module_content").val(),i=c("#new_module_type").val(),n=c("#new_template_saveas_dropdown").val();l.util.ajax("create_new_module",{name:e,template:c("#mailster_template_name").val(),auto:i,file:n,content:t},function(e){if(e.success){c("#module-selector").find(".custom-modules").html(e.data.html);tb_remove();!l.modules.showSelector&&w()}else{alert(e.data.msg)}l.trigger("enable");a.css("visibility","hidden")},function(e,t,i){l.trigger("enable");a.css("visibility","hidden")});return false}function $(){var n,s=c("<dropzone></dropzone>"),i=s.clone(),t=s.add(i);l.editor.$.document.off(".mailster").on("click.mailster","button.up",f).on("click.mailster","button.down",p).on("click.mailster","button.auto",h).on("click.mailster","button.duplicate",m).on("click.mailster","button.remove",g).on("click.mailster","button.codeview",_).on("click.mailster","button.save",b);a.off(".mailster").on("dragstart.mailster","li",function(a){a.originalEvent.dataTransfer.setData("Text",this.id);l.modules.dragging=true;l.editor.$.body.addClass("drag-active");l.editor.$.container.on("dragenter.mailster",function(e){var t=c(e.target).closest("module");if(!t.length||n&&n[0]===t[0])return;n=t;i.appendTo(n);s.prependTo(n);setTimeout(function(){i.addClass("visible");s.addClass("visible");l.editor.$.modules.removeClass("drag-up drag-down");t.prevAll("module").addClass("drag-up");t.nextAll("module").addClass("drag-down")},1)}).on("dragover.mailster",function(e){e.preventDefault()}).on("drop.mailster",function(e){var t=c(a.target).find("script").html(),i=c(a.target).data("id");v(r(t),l.editor.$.modules.length?n&&n[0]===l.editor.$.container?false:n:false,s[0]===e.target,false,i);e.preventDefault()});t.on("dragenter.mailster",function(e){c(this).addClass("drag-over")}).on("dragleave.mailster",function(e){c(this).removeClass("drag-over")})}).on("dragend.mailster","li",function(e){n=null;l.editor.$.body.removeClass("drag-active");t.removeClass("visible drag-over").remove();l.editor.$.modules.removeClass("drag-up drag-down");l.editor.$.container.off("dragenter.mailster").off("dragover.mailster").off("drop.mailster");t.off("dragenter.mailster").off("dragleave.mailster");l.modules.dragging=false})}c(".meta-box-sortables").on("sortstop",function(e,t){if(t.item[0]===l.dom.template){l.editor.$.body.addClass("reload-page")}});l.editable&&l.$.template.on("click","a.toggle-modules",w).on("keydown","a.addmodule",function(e){if(13==e.which){d.call(this)}}).on("click","a.addmodule",d).on("click","a.deletemodule",u).on("click","#module-search-remove",function(){n.val("").focus().trigger("keyup");return false});l.editable&&l.$.document.on("click","button.save-module",y).on("click","button.save-module-cancel",tb_remove);n.on("keyup",k).on("focus",function(){n.select()});l.events.push("editorLoaded",$);return l}(mailster||{},jQuery,window,document);mailster=function(o,r,e,n){"use strict";var s={unknown_cities:[],geodata:null,map:null,options:{legend:false,region:"world",resolution:"countries",datalessRegionColor:"#ffffff",enableRegionInteractivity:true,colors:["#d7f1fc",o.colors.main],backgroundColor:{fill:"none",stroke:null,strokeWidth:0}}};o.$.details=r("#mailster_details .inside");o.details=o.details||{};o.details.$={};o.details.$.subject=r("#mailster_subject");o.details.$.preheader=r("#mailster_preheader");o.details.$.from=r("#mailster_from");o.details.$.from_name=r("#mailster_from-name");o.details.$.replyto=r("#mailster_reply-to");o.$.title.on("change",function(){if(!o.details.$.subject.val())o.details.$.subject.val(r(this).val())});o.$.details.on("click",".default-value",function(){var e=r(this);r("#"+e.data("for")).val(e.data("value"))}).on("click","#show_recipients",function(){var t=r(this),i=r("#recipients-list"),a=r("#recipients-ajax-loading");if(!i.is(":hidden")){t.removeClass("open");i.slideUp(100);return false}a.css("display","inline");o.util.ajax("get_recipients",{id:o.campaign_id},function(e){t.addClass("open");a.hide();i.html(e.data.html).slideDown(100)},function(e,t,i){a.hide()});return false}).on("click","#show_clicks",function(){var t=r(this),i=r("#clicks-list"),a=r("#clicks-ajax-loading");if(!i.is(":hidden")){t.removeClass("open");i.slideUp(100);return false}a.css("display","inline");o.util.ajax("get_clicks",{id:o.campaign_id},function(e){t.addClass("open");a.hide();i.html(e.data.html).slideDown(100)},function(e,t,i){a.hide()});return false}).on("click","#show_environment",function(){var t=r(this),i=r("#environment-list"),a=r("#environment-ajax-loading");if(!i.is(":hidden")){t.removeClass("open");i.slideUp(100);return false}a.css("display","inline");o.util.ajax("get_environment",{id:o.campaign_id},function(e){t.addClass("open");a.hide();i.html(e.data.html).slideDown(100)},function(e,t,i){a.hide()});return false}).on("click","#show_geolocation",function(){var e=r(this),i=r("#geolocation-list"),a=r("#geolocation-ajax-loading");if(!i.is(":hidden")){e.removeClass("open");i.slideUp(100);return false}a.css("display","inline");o.util.ajax("get_geolocation",{id:o.campaign_id},function(t){e.addClass("open");a.hide();s.geodata=t.data.geodata;s.unknown_cities=t.data.unknown_cities;i.html(t.data.html).slideDown(100,function(){google.load("visualization","1.0",{packages:["geochart","corechart"],mapsApiKey:o.l10n.google?o.l10n.google.key:null,callback:function(){var e;s.map=new google.visualization.GeoChart(n.getElementById("countries_map"));google.countrydata=google.visualization.arrayToDataTable(t.data.countrydata);if(location.hash&&(e=location.hash.match(/region=([A-Z]{2})/))){c(e[1])}else{d(google.countrydata)}google.visualization.events.addListener(s.map,"regionClick",c)}});r("a.zoomout").on("click",function(){l();return false});r("#countries_table").find("tbody").find("tr").on("click",function(){var e=r(this).data("code");e=="unknown"||!e?l():c(e);return false})})},function(e,t,i){a.hide()});return false}).on("click","#show_errors",function(){var t=r(this),i=r("#error-list"),a=r("#error-ajax-loading");if(!i.is(":hidden")){t.removeClass("open");i.slideUp(100);return false}a.css("display","inline");o.util.ajax("get_errors",{id:o.campaign_id},function(e){t.addClass("open");a.hide();i.html(e.data.html).slideDown(100)},function(e,t,i){a.hide()});return false}).on("click","#show_countries",function(){r("#countries_wrap").toggle();return false}).on("click",".load-more-receivers",function(){var t=r(this),e=t.data("page"),i=t.data("types"),a=t.data("orderby"),n=t.data("order"),s=t.next().css("display","inline");o.util.ajax("get_recipients_page",{id:o.campaign_id,types:i,page:e,orderby:a,order:n},function(e){s.hide();if(e.success){t.parent().parent().replaceWith(e.data.html)}},function(e,t,i){detailbox.removeClass("loading")});return false}).on("click",".recipients-limit",function(e){if(e.altKey){r("input.recipients-limit").prop("checked",false);r(this).prop("checked",true)}}).on("change",".recipients-limit, select.recipients-order",function(e){var t=r("#recipients-list"),a=r("#recipients-ajax-loading"),i=r("input.recipients-limit:checked").map(function(){return this.value}).get(),n=r("select.recipients-order").val(),s=r("a.recipients-order").hasClass("asc")?"ASC":"DESC";a.css("display","inline");r("input.recipients-limit").prop("disabled",true);o.util.ajax("get_recipients",{id:o.campaign_id,types:i.join(","),orderby:n,order:s},function(e){a.hide();r("input.recipients-limit").prop("disabled",false);t.html(e.data.html).slideDown(100)},function(e,t,i){a.hide()});return false}).on("click","a.recipients-order",function(){r(this).toggleClass("asc");r("select.recipients-order").trigger("change")}).on("click",".show-receiver-detail",function(){var t=r(this),e=t.data("id"),i=t.data("index"),a=r("#receiver-detail-"+e+"-"+i).show();t.parent().addClass("loading").parent().addClass("expanded");o.util.ajax("get_recipient_detail",{id:e,index:i,campaignid:o.campaign_id},function(e){t.parent().removeClass("loading");if(e.success){a.find("div.receiver-detail-body").html(e.data.html).slideDown(100)}},function(e,t,i){a.removeClass("loading")});return false}).on("click","#stats label",function(){r("#recipients-list").find("input").prop("checked",false).filter("input."+r(this).attr("class")).prop("checked",true).trigger("change")});r.easyPieChart&&o.$.details.find(".piechart").easyPieChart({animate:2e3,rotate:180,barColor:o.colors.main,trackColor:o.colors.track,lineWidth:9,size:75,lineCap:"butt",onStep:function(e){this.$el.find("span").text(Math.round(e))},onStop:function(e){this.$el.find("span").text(Math.round(e))}});function l(){var e={region:"world",displayMode:"region",resolution:"countries",colors:["#D7E4E9",o.colors.main]};d(google.countrydata,e);r("#countries_table").find("tr").removeClass("wp-ui-highlight");r("#mapinfo").hide();location.hash="#region="}function c(e){var t={},i=e.region?e.region:e,a,n;if(i.match(/-/))return false;t["region"]=i;s.unknown_cities[i]?r("#mapinfo").show().html(o.util.sprintf(o.l10n.campaigns.unknown_locations,s.unknown_cities[i])):r("#mapinfo").hide();a=s.geodata[i]?s.geodata[i]:[];t["resolution"]="provinces";t["displayMode"]="markers";t["dataMode"]="markers";t["colors"]=["#4EBEE9",o.colors.main];n=new google.visualization.DataTable;n.addColumn("number","Lat");n.addColumn("number","Long");n.addColumn("string","tooltip");n.addColumn("number","Value");n.addColumn({type:"string",role:"tooltip"});n.addRows(a);r("#countries_table").find("tr").removeClass("wp-ui-highlight");r("#country-row-"+i).addClass("wp-ui-highlight");location.hash="#region="+i;d(n,t)}function d(e,t){t=r.extend(s.options,t);s.map.draw(e,t);r("a.zoomout").css({visibility:t["region"]!="world"?"visible":"hidden"})}function t(i){var a=i;r.each(regions,function(e,t){if(r.inArray(i,t)!=-1)a=e});return a}return o}(mailster||{},jQuery,window,document);mailster=function(u,f,e,t){"use strict";u.clickmap=u.clickmap||{};u.clickmap.$={};u.clickmap.$.popup=f("#clickmap-stats");u.$.template.on("click","a.getplaintext",function(){var a=u.$.excerpt.val();u.$.excerpt.val(u.l10n.campaigns.loading);u.util.ajax("get_plaintext",{html:u.editor.getContent()},function(e){u.$.excerpt.val(e)},function(e,t,i){u.$.excerpt.val(a)},"HTML")}).on("change","#plaintext",function(){var e=f(this).is(":checked");u.$.excerpt.prop("disabled",e)[e?"addClass":"removeClass"]("disabled")}).on("mouseenter","a.clickbadge",function(){var e=f(this),t=e.position(),i=e.data("p"),a=e.data("link"),n=e.data("clicks"),s=e.data("total");u.clickmap.$.popup.find(".piechart").data("easyPieChart").update(i);u.clickmap.$.popup.find(".link").html(a);u.clickmap.$.popup.find(".clicks").html(n);u.clickmap.$.popup.find(".total").html(s);u.clickmap.$.popup.stop().fadeIn(100).css({top:t.top-85,left:t.left-(u.clickmap.$.popup.width()/2-e.width()/2)})}).on("mouseleave","a.clickbadge",function(){u.clickmap.$.popup.stop().fadeOut(400)});u.clickmap.updateBadges=function(e){u.$.templateWrap.find(".clickbadge").remove();var e=e||f("#mailster_click_stats").data("stats"),d=parseInt(e.total,10);if(!d)return;f.each(e.clicks,function(c,e){f.each(e,function(e,t){var i=u.$.iframe.contents().find('a[href="'+c.replace("&amp;","&")+'"]').eq(e);if(i.length){i.css("display","inline-block");var a=i.offset(),n=a.top,s=a.left+5,o=t.clicks/d*100,r=(o<1?"&lsaquo;1":Math.round(o))+"%",l=f('<a class="clickbadge '+(o<40?"clickbadge-outside":"")+'" data-p="'+o+'" data-link="'+c+'" data-clicks="'+t.clicks+'" data-total="'+t.total+'"><span style="width:'+Math.max(0,o-2)+'%">'+(o<40?"&nbsp;":r)+"</span>"+(o<40?" "+r:"")+"</a>").css({top:n,left:s}).appendTo(u.$.templateWrap)}})})};u.editable&&e.EmojiButton&&u.events.push("documentReady",function(){var e=new EmojiButton({emojiVersion:"3.0",showVariants:false,zIndex:1e3});f(".emoji-selector").on("click","button",function(){var i=t.querySelector("#"+f(this).data("input"));e.togglePicker(this);e.on("emoji",function(e){var t=i.selectionStart;i.value=i.value.substring(0,t)+e+i.value.substring(t);setTimeout(function(){i.focus();i.setSelectionRange(t+1,t+1)},10)});return false})});!u.editable&&u.events.push("documentReady",function(){f.easyPieChart&&u.clickmap.$.popup.find(".piechart").easyPieChart({animate:2e3,rotate:180,barColor:u.colors.main,trackColor:u.colors.track,lineWidth:9,size:75,lineCap:"butt",onStep:function(e){this.$el.find("span").text(Math.round(e))},onStop:function(e){this.$el.find("span").text(Math.round(e))}})});!u.editable&&u.events.push("iframeLoaded",function(){u.$.iframe.height(Math.max(500,u.dom.iframe.contentWindow.document.body.scrollHeight));u.clickmap.updateBadges();u.$.iframecontents&&u.$.iframecontents.on("click","a",function(){e.open(this.href);return false})});return u}(mailster||{},jQuery,window,document);mailster=function(e,t,i,a){"use strict";e.$.submit=t("#mailster_submitdiv .inside");e.submit=e.submit||{};e.$.submit.on("change","#use_pwd",function(){t("#password-wrap").slideToggle(200).find("input").focus().select();t("#post_password").prop("disabled",!t(this).is(":checked"))}).on("click",".sendnow-button",function(){if(!confirm(e.l10n.campaigns.send_now))return false});e.submit.$={};return e}(mailster||{},jQuery,window,document);mailster=function(h,g,e,r){"use strict";h.$.delivery=g("#mailster_delivery .inside");h.delivery=h.delivery||{};h.delivery.$={};h.$.delivery.on("change","input.userexactdate",function(){g(this).parent().parent().parent().find("span").addClass("disabled");g(this).parent().find("span").removeClass("disabled")}).on("change","#autoresponder-post_type",function(){var t=g("#autoresponder-taxonomies");t.find("select").prop("disabled",true);h.util.ajax("get_post_term_dropdown",{labels:false,names:true,posttype:g(this).val(),id:h.campaign_id},function(e){if(e.success){t.html(e.data.html);g.fn.select2&&g("#autoresponder-taxonomies").find("select").select2({tags:true})}},function(e,t,i){n(false)})}).on("click",".category-tabs a",function(){var e=g(this),t=e.attr("href");h.$.delivery.find(".tabs-panel").hide();h.$.delivery.find(".tabs").removeClass("tabs");e.parent().addClass("tabs");g(t).show();g("#mailster_is_autoresponder").val(t=="#autoresponder"?1:"");return false}).on("click",".mailster_sendtest",function(){var a=g(this);n(true);a.prop("disabled",true);h.trigger("save");h.util.ajax("send_test",{formdata:h.$.form.serialize(),to:g("#mailster_testmail").val()?g("#mailster_testmail").val():g("#mailster_testmail").attr("placeholder"),content:h.$.content.val(),head:h.$.head.val(),plaintext:h.$.excerpt.val()},function(e){n(false);a.prop("disabled",false);h.util.tempMsg(e.data.msg,!e.success?"error":"updated",a.parent())},function(e,t,i){n(false);a.prop("disabled",false);h.util.tempMsg(t+" "+e.status+": "+i,"error",a.parent())})}).on("click",".mailster_precheck",function(){h.optionbar.precheck&&h.optionbar.precheck();h.precheck.terms_accepted&&h.precheck.start()}).on("change","#mailster_data_active",function(){g(this).is(":checked")?g(".active_wrap").addClass("disabled"):g(".active_wrap").removeClass("disabled");g(".deliverydate, .deliverytime").prop("disabled",!g(this).is(":checked"))}).on("change","#mailster_data_autoresponder_active",function(){g(this).is(":checked")?g(".autoresponder_active_wrap").addClass("disabled"):g(".autoresponder_active_wrap").removeClass("disabled")}).on("blur","input.deliverytime",function(){h.$.document.unbind(".mailster_deliverytime")}).on("focus, click","input.deliverytime",function(e){var t=g(this),i=g(this)[0],a=t.offset().left,n=0,s=0,o=2;if(e.clientX-a>23){n=1,s=3,o=5}h.$.document.unbind(".mailster_deliverytime").on("keypress.mailster_deliverytime",function(e){if(e.keyCode==9){return(n=!n)?!h.util.selectRange(i,3,5):e.shiftKey?!h.util.selectRange(i,0,2):true}}).on("keyup.mailster_deliverytime",function(e){if(t.val().length==1){t.val(t.val()+":00");h.util.selectRange(i,1,1)}if(r.activeElement.selectionStart==2){if(t.val().substr(0,2)>23){t.trigger("change");return false}h.util.selectRange(i,3,5)}});h.util.selectRange(i,s,o)}).on("change","input.deliverytime",function(){var e=g(this),t=e.val(),i;e.addClass("inactive");if(!/^\d+:\d+$/.test(t)){if(t.length==1){t="0"+t+":00"}else if(t.length==2){t=t+":00"}else if(t.length==3){t=t.substr(0,2)+":"+t.substr(2,3)+"0"}else if(t.length==4){t=t.substr(0,2)+":"+t.substr(2,4)}}i=t.split(":");if(!/\d\d:\d\d$/.test(t)&&t!=""||i[0]>23||i[1]>59){e.val("00:00").focus();h.util.selectRange(e[0],0,2)}else{e.val(t)}}).on("change","#mailster_autoresponder_action",function(){g("#autoresponder_wrap").removeAttr("class").addClass("autoresponder-"+g(this).val())}).on("change","#time_extra",function(){g("#autoresponderfield-mailster_timebased_advanced").slideToggle()}).on("click",".mailster_autoresponder_timebased-end-schedule",function(){g(this).is(":checked")?g(".mailster_autoresponder_timebased-end-schedule-field").slideDown():g(".mailster_autoresponder_timebased-end-schedule-field").slideUp()}).on("change",".mailster-action-hooks",function(){var e=g(this).val();g(".mailster-action-hook").val(e);if(!e){g(".mailster-action-hook").focus()}}).on("change",".mailster-action-hook",function(){var e=g(this).val();if(!g(".mailster-action-hooks option[value='"+e+"']").length){g(".mailster-action-hooks").append("<option>"+e+"</option>")}g(".mailster-action-hooks").val(e)}).on("change","#list_extra",function(){if(g(this).is(":checked")){g("#mailster_list_advanced").slideDown()}else{g("#mailster_list_advanced").slideUp()}g("#list-checkboxes").find("input.list").eq(0).trigger("change")}).on("focus","input.datepicker",function(){g(this).removeClass("inactive").trigger("click")}).on("blur","input.datepicker",function(){g(".deliverydate").html(g(this).val());g(this).addClass("inactive")});g("#autoresponder-post_type").trigger("change");h.$.delivery.find("input.datepicker").not(".hasDatepicker").prop("readonly",false);h.events.push("documentReady",function(){if(/post_status=autoresponder/.test(g("#referredby").val())||/post_status=autoresponder/.test(location.search)){h.$.delivery.find('a[href="#autoresponder"]').click()}});(function(){var t,i,a,n,s,o=new Date,r=g(".time"),l=g(".deliverytime").eq(0),c=g("#mailster_data_active"),e=parseInt(r.data("timestamp"),10)*1e3,d=false,u=e-o.getTime()+o.getTimezoneOffset()*6e4;var f=d?1e3:2e4;function p(){t=new Date;o=t.getTime();t.setTime(o+u);a=t.getHours();n=t.getMinutes();if(h.enabled&&i&&n!=i[1]&&!c.is(":checked")){l.val(m(a)+":"+m(n))}i=[];i.push(t.getHours());i.push(t.getMinutes());if(d)i.push(t.getSeconds());s=i.length;for(var e=0;e<s;e++){i[e]=m(i[e])}r.html(i.join('<span class="blink">:</span>'));setTimeout(function(){p()},f)}function m(e){if(e<10){e="0"+e}return e}p()})();function n(e){if(null==e||true===e){g("#delivery-ajax-loading").css("display","inline")}else{g("#delivery-ajax-loading").hide()}}return h}(mailster||{},jQuery,window,document);mailster=function(n,s,e,t){"use strict";var i;n.$.receivers=s("#mailster_receivers .inside");n.receivers=n.receivers||{};n.receivers.$={};n.receivers.$.conditions=s(".mailster-conditions-thickbox");n.receivers.$.receiverslist=s(".mailster-receivers-thickbox");n.receivers.$.conditionsOutput=s("#mailster_conditions_render");n.receivers.$.total=s(".mailster-total");n.$.receivers.on("change","input.list",function(){n.trigger("updateCount")}).on("change","#all_lists",function(){s("#list-checkboxes").find("input.list").prop("checked",s(this).is(":checked"));n.trigger("updateCount")}).on("change","#ignore_lists",function(){var e=s(this).is(":checked");s("#list-checkboxes").each(function(){e?s(this).slideUp(200):s(this).slideDown(200)});n.trigger("updateCount")}).on("click",".edit-conditions",function(){n.util.tb_show(n.l10n.campaigns.edit_conditions,"#TB_inline?x=1&width=720&height=520&inlineId=receivers-dialog",null);return false}).on("click",".remove-conditions",function(){if(confirm(n.l10n.campaigns.remove_conditions)){s("#receivers-dialog").find(".mailster-conditions-wrap").empty();n.trigger("updateCount")}return false}).on("click",".create-new-list",function(){var e=s(this).hide();s(".create-new-list-wrap").slideDown();s(".create-list-type").trigger("change");return false}).on("click",".create-list",function(){var e=s(this),t=s(".create-list-type"),i="";if(t.val()==-1)return false;if(i=prompt(n.l10n.campaigns.enter_list_name,n.util.sprintf(n.l10n.campaigns.create_list,t.find(":selected").text(),s("#title").val()))){o(true);n.util.ajax("create_list",{name:i,listtype:t.val(),id:n.campaign_id},function(e){o(false);n.util.tempMsg(e.data.msg,!e.success?"error":"updated",s(".create-new-list-wrap"))},function(e,t,i){o(false);n.util.tempMsg(t+" "+e.status+": "+i,"error",s(".create-new-list-wrap"))})}return false}).on("change",".create-list-type",function(){var a=s(this);if(a.val()==-1)return false;a.prop("disabled",true);o(true);n.util.ajax("get_create_list_count",{listtype:a.val(),id:n.campaign_id},function(e){a.prop("disabled",false);o(false,e.data.count)},function(e,t,i){a.prop("disabled",false);o(false,"")})}).on("click",".mailster-total",function(){if("0"==n.receivers.$.total.html())return;s(".create-list-type").trigger("change");o(true);n.trigger("disable");n.util.ajax("get_totals_list",n.conditions.get(),function(e){var t=n.$.title.val();n.trigger("enable");o(false,e.data.totalformatted);n.receivers.$.receiverslist.find(".inner").html(e.data.html);n.util.tb_show(t?n.util.sprintf(n.l10n.campaigns.receivers,e.data.totalformatted,'"'+t+'"'):n.l10n.campaigns.preview,"#TB_inline?x=1"+"&width="+Math.min(900,n.$.window.width()-50)+"&height="+Math.min(800,n.$.window.height()-100)+"&inlineId=mailster_totals_lists",null)},function(e,t,i){n.trigger("enable");o(false,"?")})});n.receivers.$.receiverslist.on("click",".load-more-receivers",function(){var t=s(this),e=t.data("page"),i=t.next().css("display","inline");n.util.ajax("get_totals_list_part",n.conditions.get({page:e}),function(e){i.hide();if(e.success){t.parent().parent().replaceWith(e.data.html)}},function(e,t,i){})});e.tb_remove&&n.receivers.$.conditions.on("click",".close-conditions",tb_remove);e.tb_remove&&n.receivers.$.receiverslist.on("click",".total-lists-close",tb_remove);n.editable&&n.events.push("documentReady",function(){n.conditions&&n.conditions.init()});n.events.push("documentReady",function(){n.trigger("enable");a()});n.events.push("updateConditions",function(){n.trigger("updateCount")});n.editable&&n.events.push("updateCount",function(){clearTimeout(i);i=setTimeout(function(){o(true);n.trigger("disable");n.util.ajax("get_totals",n.conditions.get(),function(e){n.trigger("enable");o(false,e.data.totalformatted);n.receivers.$.conditionsOutput.html(e.data.conditions)},function(e,t,i){n.trigger("enable");o(false,"?")})},10)});function a(){var i=s("#list-checkboxes");n.util.ajax("get_list_counts",{formatted:true},function(e){s.each(e.data.counts,function(e,t){i.find('li[data-id="'+e+'"]').find(".count").html(n.util.sprintf("(%s)",t))})},function(e,t,i){})}function o(e,t){if(null==e||true===e){n.receivers.$.total.addClass("loading")}else{n.receivers.$.total.removeClass("loading")}if(null!=t){n.receivers.$.total.html(t)}}return n}(mailster||{},jQuery,window,document);mailster=function(r,l,e,t){"use strict";r.$.options=l("#mailster_options .inside");r.options=r.options||{};r.options.$={};r.options.$.colorInputs=r.$.options.find("input.color");r.$.options.on("click",".wp-color-result",function(){l(this).closest("li.mailster-color").addClass("open")}).on("click","a.default-value",function(){var e=l(this).prev().find("input"),t=e.data("default");e.wpColorPicker("color",t);return false}).on("click",".colorschema",function(){var e=l(this).find(".colorschema-field");r.trigger("disable");l.each(e,function(e){var t=l(this);var i=t.data("id");var a=t.data("hex");l("#mailster-color-"+i).wpColorPicker("color",a)});r.trigger("enable")}).on("click","a.select-schema",function(){l(".colorschemas").toggle();return false}).on("click","a.savecolorschema",function(){var i={},e=l("#mailster_template_name").val();l.each(r.$.options.find(".color"),function(e,t){i[l(t).data("id")]=l(t).val()});a(true);r.util.ajax("save_color_schema",{template:e,colors:i},function(e){a(false);if(e.success){l(".colorschema").first().before(l(e.data.html).hide().fadeIn())}},function(e,t,i){a(false)})}).on("click",".colorschema-delete",function(){if(confirm(r.l10n.campaigns.delete_colorschema)){var t=l(this).parent(),e=l("#mailster_template_name").val(),i=l(this).data("hash");a(true);r.util.ajax("delete_color_schema",{template:e,hash:i},function(e){a(false);if(e.success){t.fadeOut(100,function(){t.remove()})}},function(e,t,i){a(false)})}return false}).on("click",".colorschema-delete-all",function(){if(confirm(r.l10n.campaigns.delete_colorschema_all)){var t=l(".colorschema-delete").closest(".colorschema"),e=l("#mailster_template_name").val();a(true);r.util.ajax("delete_color_schema_all",{template:e},function(e){a(false);if(e.success){t.fadeOut(100,function(){t.remove()})}},function(e,t,i){a(false)})}return false}).on("change","input.color",function(e,t){var i=l(this);var a=Color(i.val()).toString().toUpperCase();var n=i.data("var");var s=i.data("value");var o=i.data("default-color");i.val(a);c(n,s,a,i,o)});l.wp.wpColorPicker&&r.options.$.colorInputs.wpColorPicker({color:true,width:250,mode:"hsl",palettes:l(".colors").data("original"),change:function(e,t){l(this).val(t.color.toString()).trigger("change")},clear:function(e,t){}});function c(n,e,s,t,i){if(n){r.editor.$.document.find("style").each(function(){var e=this.innerText;var t=e.match(new RegExp(n+":\\s?([#a-fA-F0-9]+)","gi"));if(!t)return;t=t.pop();var i=n+":"+s;this.innerHTML=e.replace(t,i);var a=r.$.head.val();r.$.head.val(a.replace(t,i))})}else{if(!e)e=s;if(!s)return false;e=e.toUpperCase();s=s.toUpperCase();if(e==s)return false;var a=r.editor.getContent(),o=new RegExp(e,"gi");if(t)t.data("value",s);if(o.test(a)){r.editor.setContent(a.replace(o,s),0)}if(i){}}return}function a(e){if(null==e||true===e){l("#colorschema-ajax-loading").css("display","inline")}else{l("#colorschema-ajax-loading").hide()}}return r}(mailster||{},jQuery,window,document);mailster=function(t,i,e,a){"use strict";t.$.attachments=i("#mailster_attachments .inside");t.attachments=t.attachments||{};t.attachments.$={};t.$.attachments.on("click",".delete-attachment",function(e){e.preventDefault();i(this).parent().remove()}).on("click",".add-attachment",function(e){e.preventDefault();if(!wp.media.frames.mailster_attachments){wp.media.frames.mailster_attachments=wp.media({title:t.l10n.campaigns.add_attachment,button:{text:t.l10n.campaigns.add_attachment},multiple:false});wp.media.frames.mailster_attachments.on("select",function(){var e=wp.media.frames.mailster_attachments.state().get("selection").first().toJSON(),t=i(".mailster-attachment").eq(0).clone();t.find("img").attr("src",e.icon);t.find(".mailster-attachment-label").html(e.filename);t.find("input").attr("name","mailster_data[attachments][]").val(e.id);t.appendTo(".mailster-attachments")})}wp.media.frames.mailster_attachments.open()});return t}(mailster||{},jQuery,window,document);mailster=function(r,l,e,t){"use strict";r.events.push("documentReady",function(){if(typeof wp!="undefined"&&wp.heartbeat)wp.heartbeat.interval("fast")});r.$.document.on("heartbeat-send",function(e,t){if(r.editable){if(t&&t["wp_autosave"]&&r.editor){t["wp_autosave"]["content"]=r.editor.getContent();t["wp_autosave"]["excerpt"]=r.$.excerpt.val();t["mailsterdata"]=r.$.datafields.serialize()}}else{if(t["wp_autosave"])delete t["wp_autosave"];t["mailster"]={page:"edit",id:r.campaign_id}}}).on("heartbeat-tick",function(e,t){if(r.editable||!t.mailster||!t.mailster[r.campaign_id])return;var i=t.mailster[r.campaign_id],a=l("#stats").find(".verybold"),n=l("#stats").find(".piechart"),s=l(".progress"),o=i.sent/i.total*100;l(".hb-sent").html(i.sent_f);l(".hb-deleted").html(i.deleted_f);l(".hb-opens").html(i.opens_f);l(".hb-clicks").html(i.clicks_f);l(".hb-clicks_total").html(i.clicks_total_f);l(".hb-unsubs").html(i.unsubs_f);l(".hb-bounces").html(i.bounces_f);l(".hb-geo_location").html(i.geo_location);l.each(i.environment,function(e){l(".hb-"+e).html((this.percentage*100).toFixed(0)+"%")});if(l("#stats_opens").length)l("#stats_opens").data("easyPieChart").update(Math.round(i.open_rate));if(l("#stats_clicks").length)l("#stats_clicks").data("easyPieChart").update(Math.round(i.click_rate));if(l("#stats_unsubscribes").length)l("#stats_unsubscribes").data("easyPieChart").update(Math.round(i.unsub_rate));if(l("#stats_bounces").length)l("#stats_bounces").data("easyPieChart").update(Math.round(i.bounce_rate));s.find(".bar").width(o+"%");s.find("span").eq(1).html(i.sent_formatted);s.find("span").eq(2).html(i.sent_formatted);s.find("var").html(Math.round(o)+"%");r.clickmap.updateBadges(i.clickbadges);if(i.status!=l("#original_post_status").val()&&!l("#mailster_status_changed_info").length){l('<div id="mailster_status_changed_info" class="error inline"><p>'+r.util.sprintf(r.l10n.campaigns.statuschanged,'<a href="post.php?post='+r.campaign_id+'&action=edit">'+r.l10n.campaigns.click_here+"</a></p></div>")).hide().prependTo("#postbox-container-2").slideDown(200)}});return r}(mailster||{},jQuery,window,document);